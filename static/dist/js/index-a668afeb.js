import{d as z,m as r,af as L,a9 as H,N as Y,B as Z,Y as G,o as A,c as O,b as l,a as c,w as v,F as W,r as X,H as ee,Z as se,ah as ae,t as $,K as q,ai as U,J as _,aj as te,ak as y,ac as M,al as P,Q as oe,R as ne,_ as le,am as ce,an as ie,ao as ue,V as de,e as Q,I as _e,k as re,v as pe,a4 as me,ap as ge,ae as ve}from"./index-f5771d3d.js";import{S as fe}from"./index-3cfd4f39.js";import"./svg-icons-681bf268.js";const ye={class:"kb-detail"},he={class:"kb-right-top"},ke={class:"kb-right-search"},we={class:"kb-right-content"},be={class:"grid-content ep-bg-purple"},Se={class:"file-name"},xe={class:"file-content"},De={class:"file-content-type"},Ce={class:"tool-tips"},Be={class:"group-btn"},Ae=z({__name:"Detail",emits:["showSessions"],setup(j,{expose:I,emit:f}){const m=r();L();const n=H({showDialog:!1,kb_id:"",item:r()}),i=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),t=r([]),g=r([]),N=()=>{p.value?g.value=t.value.filter(e=>e.filename.substring(0,e.filename.lastIndexOf(".")).indexOf(p.value)!==-1):g.value=t.value},K=async e=>{var s,o,w,b,S,x,D,C,k,u,B,V,F,J;if(!e){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=e.id,n.item=e,i.value.knowledge_base_name=e.item.knowledge_base_name,i.value.chunking_strategy=e.item.chunking_strategy,i.value.max_chunk_size_tokens=e.item.max_chunk_size_tokens,i.value.chunk_overlap_tokens=e.item.chunk_overlap_tokens,i.value.folder_path_base="",n.showDialog=!0,t.value=[],g.value=[];const d=await te(n.kb_id);d.status===200&&((s=d.data)==null?void 0:s.status)===200&&(""+JSON.stringify((o=d.data.data)==null?void 0:o.data),t.value=[...t.value,...y((b=(w=d.data.data)==null?void 0:w.data)==null?void 0:b[".md"])],t.value=[...t.value,...y((x=(S=d.data.data)==null?void 0:S.data)==null?void 0:x[".pdf"])],t.value=[...t.value,...y((C=(D=d.data.data)==null?void 0:D.data)==null?void 0:C[".doc"])],t.value=[...t.value,...y((u=(k=d.data.data)==null?void 0:k.data)==null?void 0:u[".docx"])],t.value=[...t.value,...y((V=(B=d.data.data)==null?void 0:B.data)==null?void 0:V[".ppt"])],t.value=[...t.value,...y((J=(F=d.data.data)==null?void 0:F.data)==null?void 0:J[".pptx"])],g.value=t.value)}catch{}},E=async()=>{n.showDialog=!1},R=async e=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const o=await P(e);o.status===200&&((s=o.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),a("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},T=async()=>{var e;(e=m.value)==null||e.openUpDialog(n.item)},h=()=>{a("showSessions")};I({openDetail:K,closeDetail:E});const a=f;return(e,s)=>{const o=Y("search"),w=oe,b=ne,S=le,x=ce,D=ie,C=ue,k=de;return Z((A(),O("div",ye,[l("div",he,[s[3]||(s[3]=l("div",{class:"kb-right-top-title"},"文件列表",-1)),l("div",ke,[c(b,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:N},{suffix:v(()=>[c(w,{class:"el-input__icon"},{default:v(()=>[c(o)]),_:1})]),_:1},8,["modelValue"])])]),l("div",we,[c(C,{gutter:20},{default:v(()=>[(A(!0),O(W,null,X(g.value,(u,B)=>(A(),ee(D,{span:8,key:B},{default:v(()=>[l("div",be,[c(S,{"icon-class":se(ae)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),c(x,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:v(()=>[l("span",Se,$(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",xe,[s[5]||(s[5]=l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),l("div",De,[s[4]||(s[4]=l("span",null,"手动",-1)),l("div",Ce," chunk_size："+$(i.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+$(i.value.chunk_overlap_tokens),1)])]),l("div",Be,[c(k,{class:"primary-btn",type:"primary",onClick:s[1]||(s[1]=u=>T())},{default:v(()=>s[6]||(s[6]=[q(" 编辑 ")])),_:1}),c(k,{class:"default-btn",plain:"",onClick:s[2]||(s[2]=u=>R(n.kb_id))},{default:v(()=>s[7]||(s[7]=[q(" 删除 ")])),_:1})]),c(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:h},null,512)],512)),[[G,n.showDialog]])}}});const Ie=Q(Ae,[["__scopeId","data-v-0fb9c95a"]]),Ne={class:"kb"},Ke={class:"kb-right"},Ee=z({__name:"index",setup(j){const{proxy:I}=pe(),f=r(),m=r();L();const n=r({knowledge_new_name:"",init:!1}),i=r([]);I.$mitt.on("showAllKB",()=>{_e(async()=>{p()})});const p=async()=>{var a;try{i.value=[];const e=await me();e.status===200&&((a=e.data)==null?void 0:a.status)===200&&e.data.data&&e.data.data.length>0&&(i.value=e.data.data.map(s=>({id:s.knowledge_base_id,name:s.knowledge_base_name,item:s})))}catch{}},t=()=>{var a;p(),(a=f.value)==null||a.closeDetail()},g=()=>{var a;(a=m.value)==null||a.openDialog()},N=a=>{var e;""+JSON.stringify(a),(e=f.value)==null||e.openDetail(a)},K=async a=>{var s;""+JSON.stringify(a);const e=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{n.value={knowledge_new_name:"",init:!1},n.value.knowledge_new_name=a.name,n.value.init=!1;let o=await ge(a.id,n.value);o.status===200&&((s=o.data)==null?void 0:s.status)===200?(e.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),t()):(e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch{e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},E=a=>{var e;""+JSON.stringify(a),(e=m.value)==null||e.openUpDialog(a)},R=a=>{""+JSON.stringify(a),T(a.id)},T=async a=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e,s;try{const o=await P(a);o.status===200&&((e=o.data)==null?void 0:e.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),p(),(s=f.value)==null||s.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},h=ve();return re(()=>{var a;if(h.query.type,h.query.type&&h.query.type==="add"){(a=m.value)==null||a.openDialog();const e=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",e)}p()}),(a,e)=>(A(),O("div",Ne,[c(fe,{title:"添加知识库",list:i.value,onAddSession:g,onQuerySession:N,onEditSession:E,onEditSessionName:K,onDeleteSession:R},null,8,["list"]),l("div",Ke,[c(Ie,{ref_key:"DetailRef",ref:f,onShowSessions:t},null,512)]),c(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:t},null,512)]))}});const Oe=Q(Ee,[["__scopeId","data-v-14ba93bc"]]);export{Oe as default};
