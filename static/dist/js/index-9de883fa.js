import{d as V,m as f,aa as C,B as $,Z as P,o as B,c as A,a as n,w as c,b as I,K as x,J as d,ab as q,ac as N,ad as k,ae as E,S as T,U as J,W as F,V as O,e as U,I as M,k as z,v as H,a6 as K,af as L,ag as Q,ah as W}from"./index-0fc4054b.js";import{S as Z}from"./index-92d9d2a6.js";import"./svg-icons-681bf268.js";const j={class:"db-detail"},G={class:"group-btn"},X=V({__name:"Detail",emits:["showSessions"],setup(R,{expose:v,emit:_}){const m=f(),u=C({showDialog:!1,db_id:""}),t=f({hostname:"",port:"",username:"",password:"",database_name:""}),g=C({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),b=async()=>{u.showDialog=!1},w=async i=>{var a,l;if(!i){d({type:"error",message:"参数异常",customClass:"custom-message"});return}try{(a=m.value)==null||a.resetFields(),u.db_id=i;const e=await q(u.db_id);e.status===200&&((l=e.data)==null?void 0:l.status)===200&&(t.value.hostname=e.data.data.db_info.hostname,t.value.port=e.data.data.db_info.port+"",t.value.username=e.data.data.db_info.username,t.value.password=e.data.data.db_info.password,t.value.database_name=e.data.data.db_info.database_name,u.showDialog=!0)}catch{}},h=async i=>{i&&await i.validate(async(a,l)=>{var e;if(a){const s=d({type:"info",message:"数据库保存中...",customClass:"custom-loading-message"});try{const r=await N(u.db_id,t.value);r.status===200&&((e=r.data)==null?void 0:e.status)===200?(y("showSessions"),s.close(),d({type:"success",message:"数据库保存成功！",customClass:"custom-message"})):(s.close(),d({type:"error",message:"数据库保存失败，请重试！",customClass:"custom-message"}))}catch{s.close(),d({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}}})},D=async i=>{k.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var a;try{const l=await E(i);l.status===200&&((a=l.data)==null?void 0:a.status)===200&&(d({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),y("showSessions"),u.showDialog=!1)}catch{d({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};v({openDetail:w,closeDetail:b});const y=_;return(i,a)=>{const l=T,e=J,s=F,r=O;return $((B(),A("div",j,[n(r,{ref_key:"formRef",ref:m,rules:g,model:t.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:c(()=>[n(e,{label:"Host",prop:"hostname"},{default:c(()=>[n(l,{class:"input-width",modelValue:t.value.hostname,"onUpdate:modelValue":a[0]||(a[0]=o=>t.value.hostname=o),placeholder:""},null,8,["modelValue"])]),_:1}),n(e,{label:"Port",prop:"port"},{default:c(()=>[n(l,{class:"input-width",modelValue:t.value.port,"onUpdate:modelValue":a[1]||(a[1]=o=>t.value.port=o),placeholder:""},null,8,["modelValue"])]),_:1}),n(e,{label:"User",prop:"username"},{default:c(()=>[n(l,{class:"input-width",modelValue:t.value.username,"onUpdate:modelValue":a[2]||(a[2]=o=>t.value.username=o),placeholder:""},null,8,["modelValue"])]),_:1}),n(e,{label:"Pwd",prop:"password"},{default:c(()=>[n(l,{class:"input-width",type:"password",modelValue:t.value.password,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.password=o),placeholder:"","show-password":""},null,8,["modelValue"])]),_:1}),n(e,{label:"db_name",prop:"database_name"},{default:c(()=>[n(l,{class:"input-width",modelValue:t.value.database_name,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.database_name=o),placeholder:""},null,8,["modelValue"])]),_:1}),n(e,null,{default:c(()=>[I("div",G,[n(s,{class:"primary-btn",type:"primary",onClick:a[5]||(a[5]=o=>h(m.value))},{default:c(()=>a[7]||(a[7]=[x("保存")])),_:1}),n(s,{class:"default-btn",plain:"",onClick:a[6]||(a[6]=o=>D(u.db_id))},{default:c(()=>a[8]||(a[8]=[x(" 删除")])),_:1})])]),_:1})]),_:1},8,["rules","model"])],512)),[[P,u.showDialog]])}}});const Y=U(X,[["__scopeId","data-v-b12fb2ac"]]),ee={class:"db"},se={class:"db-right"},ae=V({__name:"index",setup(R){const{proxy:v}=H(),_=f(),m=f();Q();const u=f([]);v.$mitt.on("showAllDB",()=>{M(async()=>{g()})});const t=f({hostname:"",port:"",username:"",password:"",database_name:""}),g=async()=>{var e;u.value=[];try{const s=await K();s.status===200&&((e=s.data)==null?void 0:e.status)===200&&s.data.data&&s.data.data.length>0&&(u.value=s.data.data.map(r=>({id:r.id,name:r.database_name})))}catch{}},b=()=>{var e;g(),(e=m.value)==null||e.closeDetail()},w=()=>{var e;(e=_.value)==null||e.openDialog()},h=e=>{var s;""+JSON.stringify(e),(s=m.value)==null||s.openDetail(e.id)},D=async e=>{var r,o;""+JSON.stringify(e);const s=d({type:"info",message:"数据库重命名中...",customClass:"custom-loading-message"});try{let p=await q(e.id);if(p.status===200&&((r=p.data)==null?void 0:r.status)===200){t.value.hostname=p.data.data.db_info.hostname,t.value.port=p.data.data.db_info.port+"",t.value.username=p.data.data.db_info.username,t.value.password=p.data.data.db_info.password,t.value.database_name=e.name;let S=await N(e.id,t.value);S.status===200&&((o=S.data)==null?void 0:o.status)===200?(s.close(),d({type:"success",message:"数据库重命名成功！",customClass:"custom-message"}),b()):(s.close(),d({type:"error",message:"数据库重命名失败，请重试！",customClass:"custom-message"}))}}catch{s.close(),d({type:"error",message:"数据库重命名失败，请重试！",customClass:"custom-message"})}},y=e=>{var s;""+JSON.stringify(e),(s=_.value)==null||s.openDialog(e.id)},i=async e=>{""+JSON.stringify(e),a(e.id)},a=async e=>{k.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s,r;try{const o=await E(e);o.status===200&&((s=o.data)==null?void 0:s.status)===200&&(d({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),g(),(r=m.value)==null||r.closeDetail())}catch{d({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})},l=L();return z(()=>{var e;if(l.query.type,l.query.type&&l.query.type==="add"){(e=_.value)==null||e.openDialog();const s=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",s)}g()}),(e,s)=>(B(),A("div",ee,[n(Z,{title:"添加数据库","session-type":"DB",list:u.value,onAddSession:w,onQuerySession:h,onEditSession:y,onEditSessionName:D,onDeleteSession:i},null,8,["list"]),I("div",se,[n(Y,{ref_key:"DetailRef",ref:m,onShowSessions:b},null,512)]),n(W,{ref_key:"AddDialogRef",ref:_,onShowSessions:b},null,512)]))}});const ne=U(ae,[["__scopeId","data-v-a6aaeb4b"]]);export{ne as default};
