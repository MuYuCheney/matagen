import{d as q,m as r,af as z,a9 as W,O as Z,C as G,Z as H,o as A,c as $,a as l,b as c,w as v,F as X,r as Y,I as ee,u as se,ah as te,t as T,L as V,ai as U,K as _,aj as ae,ak as y,ac as M,al as P,R as oe,S as ne,_ as le,am as ce,an as ie,ao as ue,W as de,e as j,J as _e,k as re,x as pe,a4 as me,ap as ge,ae as ve}from"./index-157b4fa1.js";import{S as fe}from"./index-229a719e.js";import"./svg-icons-d473d0e7.js";const ye={class:"kb-detail"},he={class:"kb-right-top"},ke={class:"kb-right-search"},we={class:"kb-right-content"},be={class:"grid-content ep-bg-purple"},Se={class:"file-name"},xe={class:"file-content"},De={class:"file-content-type"},Ce={class:"tool-tips"},Be={class:"group-btn"},Ae=q({__name:"Detail",emits:["showSessions"],setup(Q,{expose:I,emit:f}){const m=r();z();const n=W({showDialog:!1,kb_id:"",item:r()}),i=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),a=r([]),g=r([]),K=()=>{p.value?g.value=a.value.filter(e=>e.filename.substring(0,e.filename.lastIndexOf(".")).indexOf(p.value)!==-1):g.value=a.value},N=async e=>{var s,o,w,b,S,x,D,C,k,u,B,F,J,L;if(!e){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=e.id,n.item=e,i.value.knowledge_base_name=e.item.knowledge_base_name,i.value.chunking_strategy=e.item.chunking_strategy,i.value.max_chunk_size_tokens=e.item.max_chunk_size_tokens,i.value.chunk_overlap_tokens=e.item.chunk_overlap_tokens,i.value.folder_path_base="",n.showDialog=!0,a.value=[],g.value=[];const d=await ae(n.kb_id);d.status===200&&((s=d.data)==null?void 0:s.status)===200&&(""+JSON.stringify((o=d.data.data)==null?void 0:o.data),a.value=[...a.value,...y((b=(w=d.data.data)==null?void 0:w.data)==null?void 0:b[".md"])],a.value=[...a.value,...y((x=(S=d.data.data)==null?void 0:S.data)==null?void 0:x[".pdf"])],a.value=[...a.value,...y((C=(D=d.data.data)==null?void 0:D.data)==null?void 0:C[".doc"])],a.value=[...a.value,...y((u=(k=d.data.data)==null?void 0:k.data)==null?void 0:u[".docx"])],a.value=[...a.value,...y((F=(B=d.data.data)==null?void 0:B.data)==null?void 0:F[".ppt"])],a.value=[...a.value,...y((L=(J=d.data.data)==null?void 0:J.data)==null?void 0:L[".pptx"])],g.value=a.value)}catch{}},E=async()=>{n.showDialog=!1},R=async e=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const o=await P(e);o.status===200&&((s=o.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),t("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},O=async()=>{var e;(e=m.value)==null||e.openUpDialog(n.item)},h=()=>{t("showSessions")};I({openDetail:N,closeDetail:E});const t=f;return(e,s)=>{const o=Z("search"),w=oe,b=ne,S=le,x=ce,D=ie,C=ue,k=de;return G((A(),$("div",ye,[l("div",he,[s[3]||(s[3]=l("div",{class:"kb-right-top-title"},"文件列表",-1)),l("div",ke,[c(b,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:v(()=>[c(w,{class:"el-input__icon"},{default:v(()=>[c(o)]),_:1})]),_:1},8,["modelValue"])])]),l("div",we,[c(C,{gutter:20},{default:v(()=>[(A(!0),$(X,null,Y(g.value,(u,B)=>(A(),ee(D,{span:8,key:B},{default:v(()=>[l("div",be,[c(S,{"icon-class":se(te)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),c(x,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:v(()=>[l("span",Se,T(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",xe,[s[5]||(s[5]=l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),l("div",De,[s[4]||(s[4]=l("span",null,"手动",-1)),l("div",Ce," chunk_size："+T(i.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+T(i.value.chunk_overlap_tokens),1)])]),l("div",Be,[c(k,{class:"primary-btn",type:"primary",onClick:s[1]||(s[1]=u=>O())},{default:v(()=>s[6]||(s[6]=[V(" 编辑 ")])),_:1}),c(k,{class:"default-btn",plain:"",onClick:s[2]||(s[2]=u=>R(n.kb_id))},{default:v(()=>s[7]||(s[7]=[V(" 删除 ")])),_:1})]),c(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:h},null,512)],512)),[[H,n.showDialog]])}}});const Ie=j(Ae,[["__scopeId","data-v-7ea097b9"]]),Ke={class:"kb"},Ne={class:"kb-right"},Ee=q({__name:"index",setup(Q){const{proxy:I}=pe(),f=r(),m=r();z();const n=r({knowledge_new_name:"",init:!1}),i=r([]);I.$mitt.on("showAllKB",()=>{_e(async()=>{p()})});const p=async()=>{var t;try{i.value=[];const e=await me();e.status===200&&((t=e.data)==null?void 0:t.status)===200&&e.data.data&&e.data.data.length>0&&(i.value=e.data.data.map(s=>({id:s.knowledge_base_id,name:s.knowledge_base_name,item:s})))}catch{}},a=()=>{var t;p(),(t=f.value)==null||t.closeDetail()},g=()=>{var t;(t=m.value)==null||t.openDialog()},K=t=>{var e;""+JSON.stringify(t),(e=f.value)==null||e.openDetail(t)},N=async t=>{var s;""+JSON.stringify(t);const e=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{n.value={knowledge_new_name:"",init:!1},n.value.knowledge_new_name=t.name,n.value.init=!1;let o=await ge(t.id,n.value);o.status===200&&((s=o.data)==null?void 0:s.status)===200?(e.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),a()):(e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch{e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},E=t=>{var e;""+JSON.stringify(t),(e=m.value)==null||e.openUpDialog(t)},R=t=>{""+JSON.stringify(t),O(t.id)},O=async t=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e,s;try{const o=await P(t);o.status===200&&((e=o.data)==null?void 0:e.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),p(),(s=f.value)==null||s.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},h=ve();return re(()=>{var t;if(h.query.type,h.query.type&&h.query.type==="add"){(t=m.value)==null||t.openDialog();const e=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",e)}p()}),(t,e)=>(A(),$("div",Ke,[c(fe,{title:"添加知识库",list:i.value,onAddSession:g,onQuerySession:K,onEditSession:E,onEditSessionName:N,onDeleteSession:R},null,8,["list"]),l("div",Ne,[c(Ie,{ref_key:"DetailRef",ref:f,onShowSessions:a},null,512)]),c(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:a},null,512)]))}});const $e=j(Ee,[["__scopeId","data-v-9b567c9f"]]);export{$e as default};
