import{d as z,m as r,ag as L,aa as Q,O as W,B as Z,Z as G,o as A,c as T,b as l,a as i,w as v,F as X,r as Y,H as ee,$ as se,ai as te,t as O,K as V,aj as U,J as _,ak as ae,al as y,ad as M,am as P,R as oe,S as ne,_ as le,an as ie,ao as ce,ap as ue,W as de,e as j,I as _e,k as re,v as pe,a5 as me,aq as ge,af as ve}from"./index-0fc4054b.js";import{S as fe}from"./index-92d9d2a6.js";import"./svg-icons-681bf268.js";const ye={class:"kb-detail"},he={class:"kb-right-top"},ke={class:"kb-right-search"},we={class:"kb-right-content"},Se={class:"grid-content ep-bg-purple"},xe={class:"file-name"},be={class:"file-content"},De={class:"file-content-type"},Be={class:"tool-tips"},Ce={class:"group-btn"},Ae=z({__name:"Detail",emits:["showSessions"],setup(H,{expose:I,emit:f}){const m=r();L();const n=Q({showDialog:!1,kb_id:"",item:r()}),c=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),a=r([]),g=r([]),K=()=>{p.value?g.value=a.value.filter(e=>e.filename.substring(0,e.filename.lastIndexOf(".")).indexOf(p.value)!==-1):g.value=a.value},N=async e=>{var s,o,w,S,x,b,D,B,k,u,C,q,F,J;if(!e){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=e.id,n.item=e,c.value.knowledge_base_name=e.item.knowledge_base_name,c.value.chunking_strategy=e.item.chunking_strategy,c.value.max_chunk_size_tokens=e.item.max_chunk_size_tokens,c.value.chunk_overlap_tokens=e.item.chunk_overlap_tokens,c.value.folder_path_base="",n.showDialog=!0,a.value=[],g.value=[];const d=await ae(n.kb_id);d.status===200&&((s=d.data)==null?void 0:s.status)===200&&(""+JSON.stringify((o=d.data.data)==null?void 0:o.data),a.value=[...a.value,...y((S=(w=d.data.data)==null?void 0:w.data)==null?void 0:S[".md"])],a.value=[...a.value,...y((b=(x=d.data.data)==null?void 0:x.data)==null?void 0:b[".pdf"])],a.value=[...a.value,...y((B=(D=d.data.data)==null?void 0:D.data)==null?void 0:B[".doc"])],a.value=[...a.value,...y((u=(k=d.data.data)==null?void 0:k.data)==null?void 0:u[".docx"])],a.value=[...a.value,...y((q=(C=d.data.data)==null?void 0:C.data)==null?void 0:q[".ppt"])],a.value=[...a.value,...y((J=(F=d.data.data)==null?void 0:F.data)==null?void 0:J[".pptx"])],g.value=a.value)}catch{}},E=async()=>{n.showDialog=!1},R=async e=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const o=await P(e);o.status===200&&((s=o.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),t("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},$=async()=>{var e;(e=m.value)==null||e.openUpDialog(n.item)},h=()=>{t("showSessions")};I({openDetail:N,closeDetail:E});const t=f;return(e,s)=>{const o=W("search"),w=oe,S=ne,x=le,b=ie,D=ce,B=ue,k=de;return Z((A(),T("div",ye,[l("div",he,[s[3]||(s[3]=l("div",{class:"kb-right-top-title"},"文件列表",-1)),l("div",ke,[i(S,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:v(()=>[i(w,{class:"el-input__icon"},{default:v(()=>[i(o)]),_:1})]),_:1},8,["modelValue"])])]),l("div",we,[i(B,{gutter:20},{default:v(()=>[(A(!0),T(X,null,Y(g.value,(u,C)=>(A(),ee(D,{span:8,key:C},{default:v(()=>[l("div",Se,[i(x,{"icon-class":se(te)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),i(b,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:v(()=>[l("span",xe,O(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",be,[s[5]||(s[5]=l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),l("div",De,[s[4]||(s[4]=l("span",null,"手动",-1)),l("div",Be," chunk_size："+O(c.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+O(c.value.chunk_overlap_tokens),1)])]),l("div",Ce,[i(k,{class:"primary-btn",type:"primary",onClick:s[1]||(s[1]=u=>$())},{default:v(()=>s[6]||(s[6]=[V(" 编辑 ")])),_:1}),i(k,{class:"default-btn",plain:"",onClick:s[2]||(s[2]=u=>R(n.kb_id))},{default:v(()=>s[7]||(s[7]=[V(" 删除 ")])),_:1})]),i(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:h},null,512)],512)),[[G,n.showDialog]])}}});const Ie=j(Ae,[["__scopeId","data-v-0fb9c95a"]]),Ke={class:"kb"},Ne={class:"kb-right"},Ee=z({__name:"index",setup(H){const{proxy:I}=pe(),f=r(),m=r();L();const n=r({knowledge_new_name:"",init:!1}),c=r([]);I.$mitt.on("showAllKB",()=>{_e(async()=>{p()})});const p=async()=>{var t;try{c.value=[];const e=await me();e.status===200&&((t=e.data)==null?void 0:t.status)===200&&e.data.data&&e.data.data.length>0&&(c.value=e.data.data.map(s=>({id:s.knowledge_base_id,name:s.knowledge_base_name,item:s})))}catch{}},a=()=>{var t;p(),(t=f.value)==null||t.closeDetail()},g=()=>{var t;(t=m.value)==null||t.openDialog()},K=t=>{var e;""+JSON.stringify(t),(e=f.value)==null||e.openDetail(t)},N=async t=>{var s;""+JSON.stringify(t);const e=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{n.value={knowledge_new_name:"",init:!1},n.value.knowledge_new_name=t.name,n.value.init=!1;let o=await ge(t.id,n.value);o.status===200&&((s=o.data)==null?void 0:s.status)===200?(e.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),a()):(e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch{e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},E=t=>{var e;""+JSON.stringify(t),(e=m.value)==null||e.openUpDialog(t)},R=t=>{""+JSON.stringify(t),$(t.id)},$=async t=>{M.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e,s;try{const o=await P(t);o.status===200&&((e=o.data)==null?void 0:e.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),p(),(s=f.value)==null||s.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},h=ve();return re(()=>{var t;if(h.query.type,h.query.type&&h.query.type==="add"){(t=m.value)==null||t.openDialog();const e=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",e)}p()}),(t,e)=>(A(),T("div",Ke,[i(fe,{title:"添加知识库","session-type":"KB",list:c.value,onAddSession:g,onQuerySession:K,onEditSession:E,onEditSessionName:N,onDeleteSession:R},null,8,["list"]),l("div",Ne,[i(Ie,{ref_key:"DetailRef",ref:f,onShowSessions:a},null,512)]),i(U,{ref_key:"AddDialogRef",ref:m,onShowSessions:a},null,512)]))}});const Te=j(Ee,[["__scopeId","data-v-6e5ee223"]]);export{Te as default};
