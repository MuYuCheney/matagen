import{ax as Te,d as H,ac as te,q as v,l as ae,o as y,N as R,w as s,e as t,t as u,aw as Oe,p as le,b as se,f as G,$ as Ee,a as l,Q as I,ay as Ae,ai as oe,v as Y,m as Re,c as T,M as z,P as S,az as Be,aj as Ue,u as Le,ak as ze,aA as qe,F as q,r as W,K as ee,W as We,J as Je,aB as J,ab as Fe,a8 as He,ah as Ge,Z as je,_ as Qe,aC as Ke,aD as Ze,aE as Xe,aF as Ye}from"./index-5671d420.js";/* empty css                  */import{N as et,P as tt,S as at,A as lt,V as st,Q as ot,c as nt,E as rt,J as ct,a as it,b as ut,C as dt,d as _t}from"./scrollbar-59c7eccf.js";const pt=d=>Te.get("/CheckOrderExecute/GetAllWarehouseSelect?Id="+d),B=d=>(le("data-v-dc251a7f"),d=d(),se(),d),vt={class:"header"},ht={class:"detail"},gt={class:"name"},ft={class:"content"},mt={class:"item"},St=B(()=>t("div",{class:"label"},"批次：",-1)),bt={class:"value"},yt={class:"item"},Ct=B(()=>t("div",{class:"label"},"当前库位：",-1)),It={class:"value"},kt={class:"item"},wt=B(()=>t("div",{class:"label"},"所在料箱：",-1)),Nt={class:"value"},Dt={class:"item"},xt=B(()=>t("div",{class:"label"},"当前库存：",-1)),Pt={class:"value"},Vt={class:"item"},$t=B(()=>t("div",{class:"label"},"实际库存：",-1)),Mt={class:"value"},Tt=H({__name:"AddDetailDrawer",setup(d,{expose:E}){const g=te({showDrawer:!1,direction:"rtl",size:450,title:"物料详情"}),f=v();return E({openDrawer:async x=>{f.value=x,g.showDrawer=!0}}),ae(()=>{document.querySelector(".drawer-modal").setAttribute("style","height: calc(100% - 64px) !important;top:auto;bottom:0;")}),(x,P)=>{const k=Oe;return y(),R(k,{modelValue:g.showDrawer,"onUpdate:modelValue":P[0]||(P[0]=h=>g.showDrawer=h),"modal-class":"drawer-modal",title:g.title,direction:g.direction,size:g.size},{header:s(()=>[t("div",vt,u(g.title),1)]),default:s(()=>{var h,V,m,D,n;return[t("div",ht,[t("div",gt,"物料名称："+u((h=f.value)==null?void 0:h.MaterialName),1),t("div",ft,[t("div",mt,[St,t("div",bt,u((V=f.value)==null?void 0:V.BatchNo),1)]),t("div",yt,[Ct,t("div",It,u((m=f.value)==null?void 0:m.Position),1)]),t("div",kt,[wt,t("div",Nt,u((D=f.value)==null?void 0:D.BoxNo),1)]),t("div",Dt,[xt,t("div",Pt,u((n=f.value)==null?void 0:n.OriginalNumber),1)]),t("div",Vt,[$t,t("div",Mt,u(f.value&&f.value.CorrectNumber?f.value.CorrectNumber:"-"),1)])])])]}),_:1},8,["modelValue","title","direction","size"])}}});const Ot=G(Tt,[["__scopeId","data-v-dc251a7f"]]),Et={class:"info"},At={class:"dialog-footer"},Rt=H({__name:"tip-dialog",props:{title:{type:String,default:"返回"},content:{type:String,default:"当前存在未保存数据！"},confirmText:{type:String,default:"确定"},cancelText:{type:String,default:"取消"}},emits:["confirm"],setup(d,{expose:E,emit:g}){const f=v(),o=te({showDialog:!1,title:"返回"});E({openDialog:async k=>{o.showDialog=!0,f.value=k}});const P=g;return(k,h)=>{const V=Ae,m=oe,D=Ee;return y(),R(D,{class:"dialog-alert tip-dialog",modelValue:o.showDialog,"onUpdate:modelValue":h[3]||(h[3]=n=>o.showDialog=n),"align-center":!0},{footer:s(()=>[t("div",At,[l(m,{class:"dialog-footer-btn cancel-btn",onClick:h[1]||(h[1]=n=>o.showDialog=!1)},{default:s(()=>[I(u(d.cancelText),1)]),_:1}),l(m,{class:"dialog-footer-btn",type:"primary",onClick:h[2]||(h[2]=n=>P("confirm",f.value))},{default:s(()=>[I(u(d.confirmText),1)]),_:1})])]),default:s(()=>[l(V,{class:"dialog-header",title:d.title,onClose:h[0]||(h[0]=()=>o.showDialog=!1)},null,8,["title"]),t("div",Et,u(d.content),1)]),_:1},8,["modelValue"])}}});const Bt=G(Rt,[["__scopeId","data-v-b263c9da"]]),Ut={OperateNumber:[{required:!0,trigger:"blur",message:"请输入数量"}]},O=d=>(le("data-v-6759e0f5"),d=d(),se(),d),Lt={class:"page-back-header"},zt=O(()=>t("span",{class:"text-large font-500 mr-3"}," 订单执行 ",-1)),qt={class:"container"},Wt={class:"query-content"},Jt=O(()=>t("div",{class:"label"},"筛选",-1)),Ft={class:"page-content"},Ht={class:"button-group"},Gt={key:0,class:"card-list"},jt=["onClick"],Qt={class:"title"},Kt={class:"title-index"},Zt={class:"title-value"},Xt={class:"content"},Yt={class:"content-item"},ea=O(()=>t("span",{class:"content-label"},"批次：",-1)),ta={class:"content-value"},aa={class:"content-item"},la=O(()=>t("span",{class:"content-label"},"当前库位：",-1)),sa={class:"content-value"},oa={class:"content-item"},na=O(()=>t("span",{class:"content-label"},"所在料箱：",-1)),ra={class:"content-value"},ca={class:"content-item"},ia=O(()=>t("span",{class:"content-label"},"当前库存：",-1)),ua={class:"content-value"},da={class:"content-item"},_a=O(()=>t("span",{class:"content-label"},"实际库存：",-1)),pa={class:"content-value"},va={class:"card-item-btn-group"},ha={class:"popover-content"},ga={class:"popover-btn-group"},fa=H({__name:"orderImplement",setup(d){const E=Le(),g=ze(),f=[et,tt,at,lt,st],o=v([]),x=v(),P=v(),k=v({title:"提示",content:"",confirmText:"确定",cancelText:"返回"}),h=Y(()=>(n.value.CurrentPage-1)*n.value.PageSize),V=Y(()=>Math.ceil(n.value.Total/n.value.PageSize)),m=v([]),D=v([]),n=v({CurrentPage:1,PageSize:15,Total:0}),w=v({WareHouseId:"",CheckStatus:"",Text:""}),j=v(-1),U=v(),Q=v([]),A=v({OperateNumber:null}),ne=e=>{j.value=e},F=v([]),L=async()=>{const e=localStorage.getItem("checkList")?JSON.parse(localStorage.getItem("checkList")||"[]"):[];o.value=e;const{data:a}=await ot({...w.value,CurrentPage:n.value.CurrentPage,PageSize:n.value.PageSize});(a==null?void 0:a.ReturnStatus)===0?(m.value=a.Result.List,n.value=a.Result.Pagination,o.value.length&&m.value.forEach(_=>{o.value.forEach(c=>{_.Id==c.Id&&(_.ApplyNumber=c.ApplyNumber)})})):S.error(a.ErrorMessage)},re=async()=>{const{data:e}=await pt(0);(e==null?void 0:e.ReturnStatus)===0?(D.value=e.Result,w.value.WareHouseId=String(D.value[0].Value)):S.error(e.ErrorMessage)},ce=async()=>{const{data:e}=await nt();(e==null?void 0:e.ReturnStatus)===0?(F.value=e.Result,w.value.CheckStatus=String(F.value[0].Value)):S.error(e.ErrorMessage)},ie=async()=>{var a;const{data:e}=await ct();(e==null?void 0:e.ReturnStatus)===0?E.go(-1):(k.value={title:"提示",content:`${e.ErrorMessage}`,confirmText:"确定",cancelText:"返回"},(a=P.value)==null||a.openDialog())};ae(async()=>{await re(),await ce(),await L()});const ue=()=>{n.value.CurrentPage=1,n.value.Total=0,L()},K=v(),de=e=>{K.value=e},_e=e=>{n.value.CurrentPage=e.activeIndex+1,L()},pe=e=>{e.slideTo(n.value.CurrentPage-1)},ve=e=>{n.value.CurrentPage=e,K.value.slideTo(e-1),L()},he=async()=>{if(!o.value.length)return S.error("请至少选中一条数据！");const e=localStorage.getItem("editList");let a=e?JSON.parse(e):[],_=!1;if(a.forEach(i=>{o.value.forEach(C=>{i.Id==C.Id&&(_=!0)})}),!_||a.length===0){S.error("无待保存的数据，不能保存！");return}let c=a.map(i=>({WareHouseId:i.WareHouseId,MaterialId:i.MaterialId,BatchNo:i.BatchNo,ShelfUnitId:i.ShelfUnitId,ShelfNo:i.ShelfNo,ShelfUnitNo:i.ShelfUnitNo,TheStorey:i.TheStorey,MaterialName:i.MaterialName,MaterialNo:i.MaterialNo,MaterialSpecification:i.MaterialSpecification,OriginalNumber:i.OriginalNumber,CorrectNumber:i.CorrectNumber,IsProduct:i.IsProduct,CheckOrderToolDetail:i.CheckOrderToolDetail})),$={Id:g.query.Id,WarehouseId:g.query.WarehouseId,OrderMaterialDetails:c};const{data:b}=await rt($);(b==null?void 0:b.ReturnStatus)===0?(S.success("保存成功"),o.value=[]):S.error(b.ErrorMessage)},ge=e=>{var a;(a=x.value)==null||a.openDrawer(e)},fe=(e,a)=>{U.value[a].resetFields()},me=async e=>{let a=J.getCache("DeliveryData"),_=J.getCache("ReceivingData");if(!a)return S.error("请先选择出库口");const{data:c}=await dt({OrderId:g.query.Id,ShelfUnitId:e.ShelfUnitId,InTerminal:_?_.Value:"",OutTerminal:a?a.Value:"",MaterialBoxId:e.BoxId});(c==null?void 0:c.ReturnStatus)===0?S.success("叫料成功"):S.error(c.ErrorMessage)},Se=async e=>{let a=J.getCache("DeliveryData"),_=J.getCache("ReceivingData");if(!_)return S.error("请先选择入库口");const{data:c}=await _t({OrderId:g.query.Id,ShelfUnitId:e.ShelfUnitId,InTerminal:_?_.Value:"",OutTerminal:a?a.Value:"",MaterialBoxId:e.BoxId});(c==null?void 0:c.ReturnStatus)===0?S.success("送料成功"):S.error(c.ErrorMessage)},be=e=>{Q.value.push(e)},Z=e=>{Q.value[e].hide()},ye=e=>{/^[0-9]\d*$/.test(e)||(A.value.OperateNumber=e.replace(/[^0-9]/g,""))},Ce=async(e,a)=>{U.value&&await U.value[a].validate(async _=>{if(_){let c=m.value.findIndex(b=>b.Id==e.Id),$=m.value[a];c!=-1&&(m.value[a].CorrectNumber=Number(A.value.OperateNumber),o.value.includes($)||(o.value.push($),localStorage.setItem("checkList",JSON.stringify(o.value)),localStorage.setItem("editList",JSON.stringify(o.value))),Z(a))}})},Ie=()=>{ie()},ke=()=>{E.go(-1)},we=e=>{o.value=e,localStorage.setItem("checkList",JSON.stringify(o.value))},Ne=()=>{o.value.length===m.value.length?(o.value=[],localStorage.setItem("checkList",JSON.stringify(o.value))):(o.value=m.value.map(e=>e),localStorage.setItem("checkList",JSON.stringify(o.value)))};return Re(()=>{localStorage.removeItem("checkList"),localStorage.removeItem("editList")}),(e,a)=>{const _=Be,c=Fe,$=He,b=Ge,i=je,C=oe,X=Ue,De=Qe,xe=Ke,Pe=Ze,Ve=Xe,$e=Ye;return y(),T("div",null,[t("div",Lt,[l(_,{icon:z(qe),onBack:Ie},{content:s(()=>[zt]),_:1},8,["icon"])]),t("div",qt,[t("div",Wt,[Jt,l(X,{inline:!0,model:w.value,class:"demo-form-inline","show-message":!1,style:{width:"max-content"},size:"large"},{default:s(()=>[l(b,{label:"库房"},{default:s(()=>[l($,{class:"input-width",modelValue:w.value.WareHouseId,"onUpdate:modelValue":a[0]||(a[0]=p=>w.value.WareHouseId=p),placeholder:"请选择库房"},{default:s(()=>[(y(!0),T(q,null,W(D.value,p=>(y(),R(c,{key:p.Value,label:p.Name,value:p.Value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"盘点状态"},{default:s(()=>[l($,{class:"input-width",modelValue:w.value.CheckStatus,"onUpdate:modelValue":a[1]||(a[1]=p=>w.value.CheckStatus=p),placeholder:"全部"},{default:s(()=>[(y(!0),T(q,null,W(F.value,p=>(y(),R(c,{key:p.Value,label:p.Name,value:p.Value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"物料"},{default:s(()=>[l(i,{class:"input-width",modelValue:w.value.Text,"onUpdate:modelValue":a[2]||(a[2]=p=>w.value.Text=p),placeholder:"请输入物料名称/规格型号/批次号"},null,8,["modelValue"])]),_:1}),l(b,null,{default:s(()=>[l(C,{class:"qry-btn",color:"#416AF1",type:"primary",onClick:ue},{default:s(()=>[I(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),t("div",Ft,[t("div",Ht,[l(C,{type:"primary",link:"",plain:"",onClick:Ne},{default:s(()=>[I(" 全选 ")]),_:1}),l(C,{class:"button-group-oper",color:"#416AF1",type:"primary",onClick:he},{default:s(()=>[l(De,{class:"svg-icon","icon-class":"save"}),I("保存 ")]),_:1})]),l(z(ut),{modules:f,loop:!1,"slides-per-view":1,"space-between":0,virtual:"","watch-slides-progress":!0,watchSlidesVisibility:!0,"initial-slide":n.value.CurrentPage-1,pagination:{el:".swiper-pagination",type:"bullets",clickable:!0,dynamicBullets:!0,dynamicMainBullets:1,bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active"},class:"swiperBox",onSwiper:de,onSlideChange:_e,onUpdate:pe},{default:s(()=>[(y(!0),T(q,null,W(V.value,p=>(y(),R(z(it),{key:p,"virtual-index":p-1},{default:s(({isActive:Me})=>[l(Ve,{modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=r=>o.value=r),onChange:we},{default:s(()=>[Me?(y(),T("div",Gt,[(y(!0),T(q,null,W(m.value,(r,M)=>(y(),T("div",{class:ee(["card-item",{"swiper-card-active":j.value==M}]),key:M,onClick:N=>ne(M)},[t("div",Qt,[t("div",Kt,u(h.value+M+1),1),t("div",Zt,"物料名称："+u(r.MaterialName),1),l(xe,{style:{"margin-left":"auto"},size:"large",value:r},null,8,["value"])]),t("div",Xt,[t("div",Yt,[ea,t("span",ta,u(r.BatchNo),1)]),t("div",aa,[la,t("span",sa,u(r.Position),1)]),t("div",oa,[na,t("span",ra,u(r.BoxNo),1)]),t("div",ca,[ia,t("span",ua,u(r.OriginalNumber),1)]),t("div",da,[_a,t("span",pa,u(r.CorrectNumber!==null?r.CorrectNumber:"-"),1)])]),t("div",va,[l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>ge(r)},{default:s(()=>[I(" 查看 ")]),_:2},1032,["onClick"]),l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>me(r)},{default:s(()=>[I(" 叫料 ")]),_:2},1032,["onClick"]),l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>Se(r)},{default:s(()=>[I(" 送料 ")]),_:2},1032,["onClick"]),l(Pe,{"show-arrow":!0,trigger:"click","popper-class":"editNumber-popover",ref_for:!0,ref:N=>be(N)},{reference:s(()=>[l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:We(N=>fe(r,M),["stop"])},{default:s(()=>[I(" 实际库存 ")]),_:2},1032,["onClick"])]),default:s(()=>[t("div",ha,[l(X,{ref_for:!0,ref_key:"formAddRef",ref:U,model:A.value,rules:z(Ut),class:"demo-form-inline","label-width":"100px",size:"large","hide-required-asterisk":!0},{default:s(()=>[l(b,{label:"输入数量",prop:"OperateNumber"},{default:s(()=>[l(i,{class:"select","adjust-position":!0,clearable:"",modelValue:A.value.OperateNumber,"onUpdate:modelValue":a[3]||(a[3]=N=>A.value.OperateNumber=N),onInput:ye,placeholder:"请输入数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t("div",ga,[l(C,{class:"popover-btn cancel-btn",onClick:N=>Z(M)},{default:s(()=>[I(" 取消 ")]),_:2},1032,["onClick"]),l(C,{class:"popover-btn",type:"primary",onClick:N=>Ce(r,M)},{default:s(()=>[I(" 确定 ")]),_:2},1032,["onClick"])])])]),_:2},1536)]),t("div",{class:ee(["card-tag",{"not-call":r.ShelfUnitCallMaterialStatus=="0","had-call":r.ShelfUnitCallMaterialStatus=="1"||r.ShelfUnitCallMaterialStatus=="2","finish-call":r.ShelfUnitCallMaterialStatus=="4"}])},u(r.ShelfUnitCallMaterialStatusStr),3)],10,jt))),128))])):Je("",!0)]),_:2},1032,["modelValue"])]),_:2},1032,["virtual-index"]))),128)),l($e,{currentPage:n.value.CurrentPage,total:n.value.Total,pageSize:n.value.PageSize,page:V.value,onSelectPagination:ve},null,8,["currentPage","total","pageSize","page"])]),_:1},8,["initial-slide","pagination"])])]),l(Ot,{ref_key:"addDetailDrawerRef",ref:x},null,512),l(Bt,{ref_key:"tipDialogRef",ref:P,title:k.value.title,confirmText:k.value.confirmText,content:k.value.content,cancelText:k.value.cancelText,onConfirm:ke},null,8,["title","confirmText","content","cancelText"])])}}});const ya=G(fa,[["__scopeId","data-v-6759e0f5"]]);export{ya as default};
