import{d as P,q as r,u as U,ac as j,U as G,I as H,a1 as W,o as E,c as $,e as l,a as c,w as f,F as X,r as ee,N as se,M as ae,am as te,t as T,Q as L,an as M,P as _,ao as oe,ap as k,af as Q,aq as Y,Y as ne,Z as le,_ as ce,ar as ie,as as de,at as ue,ai as _e,p as re,b as pe,f as Z,l as me,a3 as ge,au as ve,ak as fe}from"./index-5671d420.js";import{S as he}from"./index-bad1fa08.js";const F=w=>(re("data-v-b3ed93d7"),w=w(),pe(),w),ye={class:"kb-detail"},ke={class:"kb-right-top"},we=F(()=>l("div",{class:"kb-right-top-title"},"文件列表",-1)),Se={class:"kb-right-search"},be={class:"kb-right-content"},xe={class:"grid-content ep-bg-purple"},De={class:"file-name"},Ce={class:"file-content"},Be=F(()=>l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),Ie={class:"file-content-type"},Ae=F(()=>l("span",null,"手动",-1)),Ne={class:"tool-tips"},Ee={class:"group-btn"},Ke=P({__name:"Detail",emits:["showSessions"],setup(w,{expose:h,emit:y}){const g=r();U();const n=j({showDialog:!1,kb_id:"",item:r()}),i=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),o=r([]),v=r([]),K=()=>{p.value?v.value=o.value.filter(a=>a.filename.substring(0,a.filename.lastIndexOf(".")).indexOf(p.value)!==-1):v.value=o.value},R=async a=>{var t,m,x,D,C,B,I,A,b,u,N,V,z,J;if(!a){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=a.id,n.item=a,i.value.knowledge_base_name=a.item.knowledge_base_name,i.value.chunking_strategy=a.item.chunking_strategy,i.value.max_chunk_size_tokens=a.item.max_chunk_size_tokens,i.value.chunk_overlap_tokens=a.item.chunk_overlap_tokens,i.value.folder_path_base="",n.showDialog=!0,o.value=[],v.value=[];const d=await oe(n.kb_id);d.status===200&&((t=d.data)==null?void 0:t.status)===200&&(console.log("res.data.data.data"+JSON.stringify((m=d.data.data)==null?void 0:m.data)),o.value=[...o.value,...k((D=(x=d.data.data)==null?void 0:x.data)==null?void 0:D[".md"])],o.value=[...o.value,...k((B=(C=d.data.data)==null?void 0:C.data)==null?void 0:B[".pdf"])],o.value=[...o.value,...k((A=(I=d.data.data)==null?void 0:I.data)==null?void 0:A[".doc"])],o.value=[...o.value,...k((u=(b=d.data.data)==null?void 0:b.data)==null?void 0:u[".docx"])],o.value=[...o.value,...k((V=(N=d.data.data)==null?void 0:N.data)==null?void 0:V[".ppt"])],o.value=[...o.value,...k((J=(z=d.data.data)==null?void 0:z.data)==null?void 0:J[".pptx"])],v.value=o.value)}catch(d){console.log(" error",d)}},q=async()=>{n.showDialog=!1},O=async a=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var t;try{const m=await Y(a);m.status===200&&((t=m.data)==null?void 0:t.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),s("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},S=async()=>{var a;(a=g.value)==null||a.openUpDialog(n.item)},e=()=>{s("showSessions")};h({openDetail:R,closeDetail:q});const s=y;return(a,t)=>{const m=G("search"),x=ne,D=le,C=ce,B=ie,I=de,A=ue,b=_e;return H((E(),$("div",ye,[l("div",ke,[we,l("div",Se,[c(D,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:f(()=>[c(x,{class:"el-input__icon"},{default:f(()=>[c(m)]),_:1})]),_:1},8,["modelValue"])])]),l("div",be,[c(A,{gutter:20},{default:f(()=>[(E(!0),$(X,null,ee(v.value,(u,N)=>(E(),se(I,{span:8,key:N},{default:f(()=>[l("div",xe,[c(C,{"icon-class":ae(te)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),c(B,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:f(()=>[l("span",De,T(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",Ce,[Be,l("div",Ie,[Ae,l("div",Ne," chunk_size："+T(i.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+T(i.value.chunk_overlap_tokens),1)])]),l("div",Ee,[c(b,{class:"primary-btn",type:"primary",onClick:t[1]||(t[1]=u=>S())},{default:f(()=>[L(" 编辑 ")]),_:1}),c(b,{class:"default-btn",plain:"",onClick:t[2]||(t[2]=u=>O(n.kb_id))},{default:f(()=>[L(" 删除 ")]),_:1})]),c(M,{ref_key:"AddDialogRef",ref:g,onShowSessions:e},null,512)],512)),[[W,n.showDialog]])}}});const Re=Z(Ke,[["__scopeId","data-v-b3ed93d7"]]),qe={class:"kb"},Oe={class:"kb-right"},Te=P({__name:"index",setup(w){const h=r(),y=r();U();const g=r({knowledge_new_name:"",init:!1}),n=r([]),i=async()=>{var e;try{n.value=[];const s=await ge();s.status===200&&((e=s.data)==null?void 0:e.status)===200&&s.data.data&&s.data.data.length>0&&(n.value=s.data.data.map(a=>({id:a.knowledge_base_id,name:a.knowledge_base_name,item:a})))}catch(s){console.log("getAllKnowledgeAPI error",s)}},p=()=>{var e;i(),(e=h.value)==null||e.closeDetail()},o=()=>{var e;(e=y.value)==null||e.openDialog()},v=e=>{var s;console.log("querySession"+JSON.stringify(e)),(s=h.value)==null||s.openDetail(e)},K=async e=>{var a;console.log("editSessionName"+JSON.stringify(e));const s=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{g.value={knowledge_new_name:"",init:!1},g.value.knowledge_new_name=e.name,g.value.init=!1;let t=await ve(e.id,g.value);t.status===200&&((a=t.data)==null?void 0:a.status)===200?(s.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),p()):(s.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch(t){s.close(),console.log("editSessionName error",t),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},R=e=>{var s;console.log("editSession"+JSON.stringify(e)),(s=y.value)==null||s.openUpDialog(e)},q=e=>{console.log("deleteSession"+JSON.stringify(e)),O(e.id)},O=async e=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s,a;try{const t=await Y(e);t.status===200&&((s=t.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),i(),(a=h.value)==null||a.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},S=fe();return me(()=>{var e;if(console.log("kb init",S.query.type),S.query.type&&S.query.type==="add"){(e=y.value)==null||e.openDialog();const s=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",s)}i()}),(e,s)=>(E(),$("div",qe,[c(he,{title:"添加知识库",list:n.value,onAddSession:o,onQuerySession:v,onEditSession:R,onEditSessionName:K,onDeleteSession:q},null,8,["list"]),l("div",Oe,[c(Re,{ref_key:"DetailRef",ref:h,onShowSessions:p},null,512)]),c(M,{ref_key:"AddDialogRef",ref:y,onShowSessions:p},null,512)]))}});const Ve=Z(Te,[["__scopeId","data-v-7275547d"]]);export{Ve as default};
