import{d as q,a1 as O,A as v,B as P,o as b,i as R,w as a,a as e,t as V,b as t,l as N,k as U,c as T,F as X,r as Y,u as Z,G as g,aa as ve,H as ee,I as se,a5 as fe,_ as te,ab as he,ac as oe,ad as ae,ae as ke,af as ye,ag as le,ah as we,a6 as be,a7 as ne,J as xe,p as ce,e as ie,g as J,f as de,N as De,O as Se,ai as Ce,a8 as _e,aj as ue,h as Ie,R as $e}from"./index-f0087198.js";import{S as Ve}from"./index-59f66837.js";/* empty css                  *//* empty css                   *//* empty css                     */const re=p=>{const r=p.substring(p.lastIndexOf(".")+1).toLowerCase();if(r=="md")return"markDown";if(r=="pdf")return"pdf";if(r=="doc"||r=="docx")return"word";if(r=="ppt"||r=="pptx")return"ppt"},A=p=>(ce("data-v-d47551af"),p=p(),ie(),p),Ae={class:"dialog-title"},Ee={class:"dialog-title-name"},Be={class:"dialog-content"},ze={class:"add"},Ne=A(()=>e("div",{class:"add-text"},"上传文件",-1)),Te=A(()=>e("div",{class:"el-upload__text"},[e("div",{class:"el-upload__text1"},"点击或拖拽文件至此区域即可上传"),e("div",{class:"el-upload__text2"},"支持单次或批量上传，支持 PDF，Word，PPT，Markdown格式的文件")],-1)),Fe={key:1,class:"kb-right-content"},Re={class:"grid-content ep-bg-purple"},Le={class:"file-name"},Ke={class:"item-stategy"},Ue=A(()=>e("div",{class:"item-stategy-label"},"chunking_stategy 参数",-1)),Oe={class:"stategy-radio1"},Pe={class:"stategy-radio2"},qe={key:0},Je=A(()=>e("div",{class:"stategy-popover-A"},null,-1)),je=A(()=>e("div",{class:"stategy-popover-B"},null,-1)),Me={class:"stategy-popover"},Ge={class:"stategy-popover-row-content"},He=A(()=>e("div",{class:"stategy-popover-row-content-label"},"chunk_size",-1)),Qe={class:"slider-demo-block-show"},We={class:"stategy-popover-row-content"},Xe=A(()=>e("div",{class:"stategy-popover-row-content-label"},"chunk__overlap_tokens",-1)),Ye={class:"slider-demo-block-show"},Ze={class:"dialog-footer group-btn"},es=q({__name:"AddDialog",emits:["showSessions"],setup(p,{expose:r,emit:$}){const c=O({showDialog:!1,formBtnLoading:!1,title:"新建知识库"}),k=O({knowledge_base_name:[{required:!0,message:"不能为空",trigger:"blur"}],chunking_strategy:[{required:!0,message:"不能为空",trigger:"blur"}],max_chunk_size_tokens:[{required:!0,message:"不能为空",trigger:"blur"}],chunk_overlap_tokens:[{required:!0,message:"不能为空",trigger:"blur"}]}),f=v(!1),s=v({knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),y=v({folderName:""}),E=v(0),C=v([]),x=()=>{c.showDialog=!0,f.value=!1,s.value={knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""},C.value=[]},i=()=>{},n=(d,o,I)=>{d.status===200&&(E.value-=1,d.data.files.forEach(h=>{C.value.unshift(h)}),f.value=!0)},w=d=>{if(!s.value.knowledge_base_name)return g({type:"error",message:"请填写知识库名称",customClass:"custom-message"}),!1;y.value.folderName=s.value.knowledge_base_name;const o=d.name.substring(d.name.lastIndexOf(".")+1).toLowerCase(),h=["md","pdf","doc","docx","ppt","pptx"].includes(o);return h||g({type:"error",message:"上传文件只能是 pdf,doc,docx,ppt,pptx,markdown",customClass:"custom-message"}),E.value+=1,h},l=async d=>{C.value.splice(d,1)},m=async()=>{var d;if(!s.value.knowledge_base_name)return g({type:"error",message:"请填写知识库名称",customClass:"custom-message"}),!1;if(C.value.length==0)return g({type:"error",message:"请上传文件",customClass:"custom-message"}),!1;try{g({type:"info",message:"知识库解析中...",customClass:"custom-loading-message"});const o=await ve("thread_jXjE1uyD6xjTcttz2TgudkO0",s.value);o.status===200&&((d=o.data)==null?void 0:d.status)===200?(D("showSessions"),g({type:"success",message:"知识库解析成功！",customClass:"custom-message"}),c.showDialog=!1):g({type:"error",message:"知识库解析失败，请重试！",customClass:"custom-message"})}catch(o){console.log("createKnowledgeAPI error",o)}};r({openDialog:x});const D=$;return(d,o)=>{const I=P("Close"),h=ee,B=se,_=fe,z=te,F=he,L=P("upload-filled"),S=oe,K=ae,M=ke,pe=ye,G=le,H=we,me=be,Q=ne,ge=xe;return b(),R(ge,{class:"custom-dialog-alert",modelValue:c.showDialog,"onUpdate:modelValue":o[7]||(o[7]=u=>c.showDialog=u),width:"800px","align-center":!0,style:{background:"#13322f"},"show-close":!1},{title:a(()=>[e("div",Ae,[e("div",Ee,V(c.title),1),e("div",{class:"dialog-close",onClick:o[0]||(o[0]=u=>c.showDialog=!1)},[t(h,{size:16},{default:a(()=>[t(I)]),_:1})])])]),footer:a(()=>[e("div",Ze,[t(Q,{class:"default-btn",onClick:o[5]||(o[5]=u=>c.showDialog=!1)},{default:a(()=>[N(" 取消 ")]),_:1}),t(Q,{class:"primary-btn",type:"primary",onClick:o[6]||(o[6]=u=>m())},{default:a(()=>[N(" 知识库解析 ")]),_:1})])]),default:a(()=>[e("div",Be,[t(me,{ref:"formRef",rules:k,"label-position":"left",model:s.value,class:"demo-form-dialog","show-message":!1,style:{width:"max-content"},size:"large"},{default:a(()=>[t(_,{label:"知识库名称","label-width":130},{default:a(()=>[t(B,{class:"input-width",modelValue:s.value.knowledge_base_name,"onUpdate:modelValue":o[1]||(o[1]=u=>s.value.knowledge_base_name=u),placeholder:""},null,8,["modelValue"])]),_:1}),t(_,{label:"上传文件","label-width":110},{default:a(()=>[f.value?(b(),R(F,{key:0,class:"upload-demo",action:"/api/upload",multiple:"","show-file-list":!1,name:"files",accept:".md,.pdf,.doc,.docx,.ppt,.pptx","on-remove":i,"on-success":n,"before-upload":w,data:y.value},{default:a(()=>[e("div",ze,[t(z,{"icon-class":"layoutAdd",className:"add-svg"}),Ne])]),_:1},8,["data"])):U("",!0)]),_:1}),f.value?U("",!0):(b(),R(F,{key:0,class:"upload-demo",drag:"",action:"/api/upload",multiple:"","show-file-list":!1,name:"files",accept:".md,.pdf,.doc,.docx,.ppt,.pptx","on-remove":i,"on-success":n,"before-upload":w,data:y.value},{default:a(()=>[t(h,{class:"el-icon--upload"},{default:a(()=>[t(L,{class:"el-icon--upload-svg"})]),_:1}),Te]),_:1},8,["data"])),f.value?(b(),T("div",Fe,[t(K,{gutter:20},{default:a(()=>[(b(!0),T(X,null,Y(C.value,(u,W)=>(b(),R(S,{span:8,key:W},{default:a(()=>[e("div",Re,[t(z,{"icon-class":Z(re)(u),className:"pdf-svg"},null,8,["icon-class"]),e("span",Le,V(u),1),t(z,{"icon-class":"fileDelete",className:"file-delete",onClick:ys=>l(W)},null,8,["onClick"])])]),_:2},1024))),128))]),_:1})])):U("",!0),e("div",Ke,[Ue,t(pe,{modelValue:s.value.chunking_strategy,"onUpdate:modelValue":o[2]||(o[2]=u=>s.value.chunking_strategy=u)},{default:a(()=>[e("div",Oe,[t(M,{value:"auto"},{default:a(()=>[N("自动")]),_:1})]),e("div",Pe,[t(M,{value:"static"},{default:a(()=>[N("手动")]),_:1})])]),_:1},8,["modelValue"]),s.value.chunking_strategy=="static"?(b(),T("div",qe,[Je,je,e("div",Me,[t(K,{class:"stategy-popover-row",gutter:54},{default:a(()=>[t(S,{span:10},{default:a(()=>[e("div",Ge,[t(G,{"popper-class":"custom-tooltip",teleported:!1,effect:"dark",content:"每个块中允许的最大Token数，该参数控制每次分块时包含的文本量",placement:"bottom"},{default:a(()=>[He]),_:1}),t(H,{class:"stategy-popover-row-content-slider",modelValue:s.value.max_chunk_size_tokens,"onUpdate:modelValue":o[3]||(o[3]=u=>s.value.max_chunk_size_tokens=u),min:0,max:800},null,8,["modelValue"]),e("div",Qe,V(s.value.max_chunk_size_tokens),1)])]),_:1}),t(S,{span:12},{default:a(()=>[e("div",We,[t(G,{"popper-class":"custom-tooltip",teleported:!1,content:"相邻块之间的重叠Token数，防止分块之间的上下文丢失",placement:"bottom"},{default:a(()=>[Xe]),_:1}),t(H,{class:"stategy-popover-row-content-slider",modelValue:s.value.chunk_overlap_tokens,"onUpdate:modelValue":o[4]||(o[4]=u=>s.value.chunk_overlap_tokens=u),min:0,max:400},null,8,["modelValue"]),e("div",Ye,V(s.value.chunk_overlap_tokens),1)])]),_:1})]),_:1})])])):U("",!0)])]),_:1},8,["rules","model"])])]),_:1},8,["modelValue"])}}});const ss=J(es,[["__scopeId","data-v-d47551af"]]),j=p=>(ce("data-v-c16a2220"),p=p(),ie(),p),ts={class:"kb-detail"},os={class:"kb-right-top"},as=j(()=>e("div",{class:"kb-right-top-title"},"文件列表",-1)),ls={class:"kb-right-search"},ns={class:"kb-right-content"},cs={class:"grid-content ep-bg-purple"},is={class:"file-name"},ds={class:"file-content"},_s=j(()=>e("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),us={class:"file-content-type"},rs=j(()=>e("span",null,"手动",-1)),ps={class:"tool-tips"},ms={class:"group-btn"},gs=q({__name:"Detail",emits:["showSessions"],setup(p,{expose:r,emit:$}){de();const c=O({showDialog:!1,kb_id:"",item:{max_chunk_size_tokens:"",chunk_overlap_tokens:""}}),k=v({knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),f=v(""),s=v([]),y=v([]),E=()=>{f.value?y.value=s.value.filter(l=>l.substring(0,l.lastIndexOf(".")).indexOf(f.value)!==-1):y.value=s.value},C=async l=>{var m,D,d,o,I,h,B;if(!l){g({type:"error",message:"参数异常",customClass:"custom-message"});return}try{c.kb_id=l.id,c.item=l.item,k.value.knowledge_base_name=l.item.knowledge_base_name,k.value.chunking_strategy=l.item.chunking_strategy,k.value.max_chunk_size_tokens=l.item.max_chunk_size_tokens,k.value.chunk_overlap_tokens=l.item.chunk_overlap_tokens,k.value.folder_path_base="",c.showDialog=!0,s.value=[],y.value=[];const _=await Ce(c.kb_id);_.status===200&&((m=_.data)==null?void 0:m.status)===200&&(console.log("res.data.data"+JSON.stringify(_.data.data)),s.value=[...s.value,...x((D=_.data.data)==null?void 0:D.md)],s.value=[...s.value,...x((d=_.data.data)==null?void 0:d.pdf)],s.value=[...s.value,...x((o=_.data.data)==null?void 0:o.doc)],s.value=[...s.value,...x((I=_.data.data)==null?void 0:I.docx)],s.value=[...s.value,...x((h=_.data.data)==null?void 0:h.ppt)],s.value=[...s.value,...x((B=_.data.data)==null?void 0:B.pptx)],y.value=s.value)}catch(_){console.log(" error",_)}},x=l=>l&&l.length>0?l:[],i=async()=>{c.showDialog=!1},n=async l=>{_e.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var m;try{const D=await ue(l);D.status===200&&((m=D.data)==null?void 0:m.status)===200&&(g({type:"success",message:"知识库删除成功",customClass:"custom-message"}),w("showSessions"),c.showDialog=!1)}catch{g({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})};r({openDetail:C,closeDetail:i});const w=$;return(l,m)=>{var F,L;const D=P("search"),d=ee,o=se,I=te,h=le,B=oe,_=ae,z=ne;return De((b(),T("div",ts,[e("div",os,[as,e("div",ls,[t(o,{class:"kb-right-search-input",modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=S=>f.value=S),placeholder:"请输入文件名称",onInput:E},{suffix:a(()=>[t(d,{class:"el-input__icon"},{default:a(()=>[t(D)]),_:1})]),_:1},8,["modelValue"])])]),e("div",ns,[t(_,{gutter:20},{default:a(()=>[(b(!0),T(X,null,Y(y.value,(S,K)=>(b(),R(B,{span:8,key:K},{default:a(()=>[e("div",cs,[t(I,{"icon-class":Z(re)(S),className:"pdf-svg"},null,8,["icon-class"]),t(h,{class:"box-item",effect:"dark",content:S,placement:"top"},{default:a(()=>[e("span",is,V(S),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),e("div",ds,[_s,e("div",us,[rs,e("div",ps," chunk_size："+V((F=c.item)==null?void 0:F.max_chunk_size_tokens)+"    chunk__overlap_tokens："+V((L=c.item)==null?void 0:L.chunk_overlap_tokens),1)])]),e("div",ms,[t(z,{class:"primary-btn",type:"primary"},{default:a(()=>[N(" 编辑 ")]),_:1}),t(z,{class:"default-btn",plain:"",onClick:m[1]||(m[1]=S=>n(c.kb_id))},{default:a(()=>[N(" 删除 ")]),_:1})])],512)),[[Se,c.showDialog]])}}});const vs=J(gs,[["__scopeId","data-v-c16a2220"]]),fs={class:"kb"},hs={class:"kb-right"},ks=q({__name:"index",setup(p){const r=v(),$=v();de(),v("");const c=v([]),k=async()=>{var i;try{const n=await $e();n.status===200&&((i=n.data)==null?void 0:i.status)===200&&n.data.data&&n.data.data.length>0&&(c.value=n.data.data.map(w=>({id:w.knowledge_base_id,name:w.knowledge_base_name,item:w})))}catch(n){console.log("getAllKnowledgeAPI error",n)}},f=()=>{k()},s=()=>{var i;(i=$.value)==null||i.openDialog()},y=i=>{var n;console.log("querySession"+JSON.stringify(i)),(n=r.value)==null||n.openDetail(i)},E=i=>{var n;console.log("editSession"+JSON.stringify(i)),(n=$.value)==null||n.openDialog()},C=i=>{console.log("deleteSession"+JSON.stringify(i)),x(i.id)},x=async i=>{_e.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var n,w;try{const l=await ue(i);l.status===200&&((n=l.data)==null?void 0:n.status)===200&&(g({type:"success",message:"知识库删除成功",customClass:"custom-message"}),k(),(w=r.value)==null||w.closeDetail())}catch{g({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{g({type:"error",message:"知识库删除失败",customClass:"custom-message"})})};return Ie(()=>{k()}),(i,n)=>(b(),T("div",fs,[t(Ve,{title:"添加知识库",list:c.value,onAddSession:s,onQuerySession:y,onEditSession:E,onDeleteSession:C},null,8,["list"]),e("div",hs,[t(vs,{ref_key:"DetailRef",ref:r,onShowSessions:f},null,512)]),t(ss,{ref_key:"AddDialogRef",ref:$},null,512)]))}});const Cs=J(ks,[["__scopeId","data-v-7f4e1565"]]);export{Cs as default};
