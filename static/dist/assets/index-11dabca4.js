import{d as M,v as p,f as U,ab as j,U as G,J as H,a0 as W,o as E,c as J,a as l,b as i,w as h,F as Z,r as ee,M as se,u as ae,ak as te,t as F,O as P,al as q,P as r,am as oe,an as y,ae as Q,ao as X,X as ne,Y as le,_ as ce,ap as ie,aq as de,ar as _e,ah as ue,p as re,e as pe,g as Y,m as me,a2 as ge,as as ve}from"./index-f3f8eb0f.js";import{S as fe}from"./index-8888c42f.js";const V=w=>(re("data-v-eb32eed5"),w=w(),pe(),w),he={class:"kb-detail"},ke={class:"kb-right-top"},ye=V(()=>l("div",{class:"kb-right-top-title"},"文件列表",-1)),we={class:"kb-right-search"},Se={class:"kb-right-content"},be={class:"grid-content ep-bg-purple"},xe={class:"file-name"},De={class:"file-content"},Ce=V(()=>l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),Be={class:"file-content-type"},Ae=V(()=>l("span",null,"手动",-1)),Ie={class:"tool-tips"},Ne={class:"group-btn"},Ee=M({__name:"Detail",emits:["showSessions"],setup(w,{expose:k,emit:S}){const v=p();U();const o=j({showDialog:!1,kb_id:"",item:p()}),d=p({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),m=p(""),t=p([]),f=p([]),K=()=>{m.value?f.value=t.value.filter(s=>s.filename.substring(0,s.filename.lastIndexOf(".")).indexOf(m.value)!==-1):f.value=t.value},O=async s=>{var n,g,x,D,C,B,A,I,b,u,N,$,z,L;if(!s){r({type:"error",message:"参数异常",customClass:"custom-message"});return}try{o.kb_id=s.id,o.item=s,d.value.knowledge_base_name=s.item.knowledge_base_name,d.value.chunking_strategy=s.item.chunking_strategy,d.value.max_chunk_size_tokens=s.item.max_chunk_size_tokens,d.value.chunk_overlap_tokens=s.item.chunk_overlap_tokens,d.value.folder_path_base="",o.showDialog=!0,t.value=[],f.value=[];const _=await oe(o.kb_id);_.status===200&&((n=_.data)==null?void 0:n.status)===200&&(console.log("res.data.data.data"+JSON.stringify((g=_.data.data)==null?void 0:g.data)),t.value=[...t.value,...y((D=(x=_.data.data)==null?void 0:x.data)==null?void 0:D[".md"])],t.value=[...t.value,...y((B=(C=_.data.data)==null?void 0:C.data)==null?void 0:B[".pdf"])],t.value=[...t.value,...y((I=(A=_.data.data)==null?void 0:A.data)==null?void 0:I[".doc"])],t.value=[...t.value,...y((u=(b=_.data.data)==null?void 0:b.data)==null?void 0:u[".docx"])],t.value=[...t.value,...y(($=(N=_.data.data)==null?void 0:N.data)==null?void 0:$[".ppt"])],t.value=[...t.value,...y((L=(z=_.data.data)==null?void 0:z.data)==null?void 0:L[".pptx"])],f.value=t.value)}catch(_){console.log(" error",_)}},R=async()=>{o.showDialog=!1},T=async s=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var n;try{const g=await X(s);g.status===200&&((n=g.data)==null?void 0:n.status)===200&&(r({type:"success",message:"知识库删除成功",customClass:"custom-message"}),c("showSessions"),o.showDialog=!1)}catch{r({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},e=async()=>{var s;(s=v.value)==null||s.openUpDialog(o.item)},a=()=>{c("showSessions")};k({openDetail:O,closeDetail:R});const c=S;return(s,n)=>{const g=G("search"),x=ne,D=le,C=ce,B=ie,A=de,I=_e,b=ue;return H((E(),J("div",he,[l("div",ke,[ye,l("div",we,[i(D,{class:"kb-right-search-input",modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=u=>m.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:h(()=>[i(x,{class:"el-input__icon"},{default:h(()=>[i(g)]),_:1})]),_:1},8,["modelValue"])])]),l("div",Se,[i(I,{gutter:20},{default:h(()=>[(E(!0),J(Z,null,ee(f.value,(u,N)=>(E(),se(A,{span:8,key:N},{default:h(()=>[l("div",be,[i(C,{"icon-class":ae(te)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),i(B,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:h(()=>[l("span",xe,F(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",De,[Ce,l("div",Be,[Ae,l("div",Ie," chunk_size："+F(d.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+F(d.value.chunk_overlap_tokens),1)])]),l("div",Ne,[i(b,{class:"primary-btn",type:"primary",onClick:n[1]||(n[1]=u=>e())},{default:h(()=>[P(" 编辑 ")]),_:1}),i(b,{class:"default-btn",plain:"",onClick:n[2]||(n[2]=u=>T(o.kb_id))},{default:h(()=>[P(" 删除 ")]),_:1})]),i(q,{ref_key:"AddDialogRef",ref:v,onShowSessions:a},null,512)],512)),[[W,o.showDialog]])}}});const Ke=Y(Ee,[["__scopeId","data-v-eb32eed5"]]),Oe={class:"kb"},Re={class:"kb-right"},Te=M({__name:"index",setup(w){const k=p(),S=p();U();const v=p({knowledge_new_name:"",init:!1}),o=p([]),d=async()=>{var e;try{o.value=[];const a=await ge();a.status===200&&((e=a.data)==null?void 0:e.status)===200&&a.data.data&&a.data.data.length>0&&(o.value=a.data.data.map(c=>({id:c.knowledge_base_id,name:c.knowledge_base_name,item:c})))}catch(a){console.log("getAllKnowledgeAPI error",a)}},m=()=>{var e;d(),(e=k.value)==null||e.closeDetail()},t=()=>{var e;(e=S.value)==null||e.openDialog()},f=e=>{var a;console.log("querySession"+JSON.stringify(e)),(a=k.value)==null||a.openDetail(e)},K=async e=>{var c;console.log("editSessionName"+JSON.stringify(e));const a=r({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{v.value={knowledge_new_name:"",init:!1},v.value.knowledge_new_name=e.name,v.value.init=!1;let s=await ve(e.id,v.value);s.status===200&&((c=s.data)==null?void 0:c.status)===200?(a.close(),r({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),m()):(a.close(),r({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch(s){a.close(),console.log("editSessionName error",s),r({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},O=e=>{var a;console.log("editSession"+JSON.stringify(e)),(a=S.value)==null||a.openUpDialog(e)},R=e=>{console.log("deleteSession"+JSON.stringify(e)),T(e.id)},T=async e=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var a,c;try{const s=await X(e);s.status===200&&((a=s.data)==null?void 0:a.status)===200&&(r({type:"success",message:"知识库删除成功",customClass:"custom-message"}),d(),(c=k.value)==null||c.closeDetail())}catch{r({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{r({type:"error",message:"知识库删除失败",customClass:"custom-message"})})};return me(()=>{d()}),(e,a)=>(E(),J("div",Oe,[i(fe,{title:"添加知识库",list:o.value,onAddSession:t,onQuerySession:f,onEditSession:O,onEditSessionName:K,onDeleteSession:R},null,8,["list"]),l("div",Re,[i(Ke,{ref_key:"DetailRef",ref:k,onShowSessions:m},null,512)]),i(q,{ref_key:"AddDialogRef",ref:S,onShowSessions:m},null,512)]))}});const Ve=Y(Te,[["__scopeId","data-v-3929a47f"]]);export{Ve as default};
