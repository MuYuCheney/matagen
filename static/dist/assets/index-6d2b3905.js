import{d as P,v as r,f as U,ab as Y,U as G,J as H,a0 as W,o as E,c as q,a as l,b as c,w as h,F as Z,r as ee,N as se,u as ae,al as te,t as $,Q as L,am as M,P as _,an as oe,ao as k,ae as Q,ap as j,X as ne,Y as le,_ as ce,aq as ie,ar as de,as as ue,ah as _e,p as re,e as pe,g as X,m as me,a6 as ge,at as ve,aj as he}from"./index-4de10589.js";import{S as fe}from"./index-f49f89aa.js";const F=w=>(re("data-v-b3ed93d7"),w=w(),pe(),w),ye={class:"kb-detail"},ke={class:"kb-right-top"},we=F(()=>l("div",{class:"kb-right-top-title"},"文件列表",-1)),Se={class:"kb-right-search"},be={class:"kb-right-content"},xe={class:"grid-content ep-bg-purple"},De={class:"file-name"},Ce={class:"file-content"},Be=F(()=>l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),Ae={class:"file-content-type"},Ie=F(()=>l("span",null,"手动",-1)),Ne={class:"tool-tips"},Ee={class:"group-btn"},Ke=P({__name:"Detail",emits:["showSessions"],setup(w,{expose:f,emit:y}){const g=r();U();const n=Y({showDialog:!1,kb_id:"",item:r()}),i=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),o=r([]),v=r([]),K=()=>{p.value?v.value=o.value.filter(a=>a.filename.substring(0,a.filename.lastIndexOf(".")).indexOf(p.value)!==-1):v.value=o.value},R=async a=>{var t,m,x,D,C,B,A,I,b,u,N,J,V,z;if(!a){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=a.id,n.item=a,i.value.knowledge_base_name=a.item.knowledge_base_name,i.value.chunking_strategy=a.item.chunking_strategy,i.value.max_chunk_size_tokens=a.item.max_chunk_size_tokens,i.value.chunk_overlap_tokens=a.item.chunk_overlap_tokens,i.value.folder_path_base="",n.showDialog=!0,o.value=[],v.value=[];const d=await oe(n.kb_id);d.status===200&&((t=d.data)==null?void 0:t.status)===200&&(console.log("res.data.data.data"+JSON.stringify((m=d.data.data)==null?void 0:m.data)),o.value=[...o.value,...k((D=(x=d.data.data)==null?void 0:x.data)==null?void 0:D[".md"])],o.value=[...o.value,...k((B=(C=d.data.data)==null?void 0:C.data)==null?void 0:B[".pdf"])],o.value=[...o.value,...k((I=(A=d.data.data)==null?void 0:A.data)==null?void 0:I[".doc"])],o.value=[...o.value,...k((u=(b=d.data.data)==null?void 0:b.data)==null?void 0:u[".docx"])],o.value=[...o.value,...k((J=(N=d.data.data)==null?void 0:N.data)==null?void 0:J[".ppt"])],o.value=[...o.value,...k((z=(V=d.data.data)==null?void 0:V.data)==null?void 0:z[".pptx"])],v.value=o.value)}catch(d){console.log(" error",d)}},O=async()=>{n.showDialog=!1},T=async a=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var t;try{const m=await j(a);m.status===200&&((t=m.data)==null?void 0:t.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),s("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},S=async()=>{var a;(a=g.value)==null||a.openUpDialog(n.item)},e=()=>{s("showSessions")};f({openDetail:R,closeDetail:O});const s=y;return(a,t)=>{const m=G("search"),x=ne,D=le,C=ce,B=ie,A=de,I=ue,b=_e;return H((E(),q("div",ye,[l("div",ke,[we,l("div",Se,[c(D,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:h(()=>[c(x,{class:"el-input__icon"},{default:h(()=>[c(m)]),_:1})]),_:1},8,["modelValue"])])]),l("div",be,[c(I,{gutter:20},{default:h(()=>[(E(!0),q(Z,null,ee(v.value,(u,N)=>(E(),se(A,{span:8,key:N},{default:h(()=>[l("div",xe,[c(C,{"icon-class":ae(te)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),c(B,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:h(()=>[l("span",De,$(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",Ce,[Be,l("div",Ae,[Ie,l("div",Ne," chunk_size："+$(i.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+$(i.value.chunk_overlap_tokens),1)])]),l("div",Ee,[c(b,{class:"primary-btn",type:"primary",onClick:t[1]||(t[1]=u=>S())},{default:h(()=>[L(" 编辑 ")]),_:1}),c(b,{class:"default-btn",plain:"",onClick:t[2]||(t[2]=u=>T(n.kb_id))},{default:h(()=>[L(" 删除 ")]),_:1})]),c(M,{ref_key:"AddDialogRef",ref:g,onShowSessions:e},null,512)],512)),[[W,n.showDialog]])}}});const Re=X(Ke,[["__scopeId","data-v-b3ed93d7"]]),Oe={class:"kb"},Te={class:"kb-right"},$e=P({__name:"index",setup(w){const f=r(),y=r();U();const g=r({knowledge_new_name:"",init:!1}),n=r([]),i=async()=>{var e;try{n.value=[];const s=await ge();s.status===200&&((e=s.data)==null?void 0:e.status)===200&&s.data.data&&s.data.data.length>0&&(n.value=s.data.data.map(a=>({id:a.knowledge_base_id,name:a.knowledge_base_name,item:a})))}catch(s){console.log("getAllKnowledgeAPI error",s)}},p=()=>{var e;i(),(e=f.value)==null||e.closeDetail()},o=()=>{var e;(e=y.value)==null||e.openDialog()},v=e=>{var s;console.log("querySession"+JSON.stringify(e)),(s=f.value)==null||s.openDetail(e)},K=async e=>{var a;console.log("editSessionName"+JSON.stringify(e));const s=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{g.value={knowledge_new_name:"",init:!1},g.value.knowledge_new_name=e.name,g.value.init=!1;let t=await ve(e.id,g.value);t.status===200&&((a=t.data)==null?void 0:a.status)===200?(s.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),p()):(s.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch(t){s.close(),console.log("editSessionName error",t),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},R=e=>{var s;console.log("editSession"+JSON.stringify(e)),(s=y.value)==null||s.openUpDialog(e)},O=e=>{console.log("deleteSession"+JSON.stringify(e)),T(e.id)},T=async e=>{Q.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s,a;try{const t=await j(e);t.status===200&&((s=t.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),i(),(a=f.value)==null||a.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},S=he();return me(()=>{var e;if(console.log("kb init",S.query.type),S.query.type&&S.query.type==="add"){(e=y.value)==null||e.openDialog();const s=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",s)}i()}),(e,s)=>(E(),q("div",Oe,[c(fe,{title:"添加知识库",list:n.value,onAddSession:o,onQuerySession:v,onEditSession:R,onEditSessionName:K,onDeleteSession:O},null,8,["list"]),l("div",Te,[c(Re,{ref_key:"DetailRef",ref:f,onShowSessions:p},null,512)]),c(M,{ref_key:"AddDialogRef",ref:y,onShowSessions:p},null,512)]))}});const Je=X($e,[["__scopeId","data-v-7275547d"]]);export{Je as default};
