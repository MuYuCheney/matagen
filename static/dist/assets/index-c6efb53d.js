import{d as x,A as g,a1 as V,B as J,o as I,i as O,w as u,a as v,t as z,b as t,l as C,G as p,a2 as k,a3 as H,a4 as P,H as L,I as U,a5 as q,a6 as $,a7 as E,J as M,g as A,N as Q,O as G,c as N,a8 as R,a9 as F,h as j,S as K,f as W}from"./index-f0087198.js";import{S as X}from"./index-59f66837.js";/* empty css                  *//* empty css                   *//* empty css                     */const Y={class:"dialog-title"},Z={class:"dialog-title-name"},ee={class:"dialog-content"},se={class:"dialog-footer group-btn"},ae=x({__name:"AddDialog",emits:["showSessions"],setup(B,{expose:f,emit:b}){const _=g(),r=V({showDialog:!1,formBtnLoading:!1,title:"连接SQL数据库"}),n=g(""),d=g({hostname:"",port:"",username:"",password:"",database_name:""}),w=V({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),h=async l=>{l&&await l.validate(async(e,s)=>{var a;if(e)try{p({type:"info",message:"数据库连接中...",customClass:"custom-loading-message"});let o;n.value?o=await k(n.value,d.value):o=await H(d.value),o.status===200&&((a=o.data)==null?void 0:a.status)===200?(y("showSessions"),p({type:"success",message:"数据库连接成功！",customClass:"custom-message"}),r.showDialog=!1):p({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}catch{p({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}})};f({openDialog:async l=>{var e,s;if(r.showDialog=!0,(e=_.value)==null||e.resetFields(),l)try{n.value=l;const a=await P(n.value);a.status===200&&((s=a.data)==null?void 0:s.status)===200&&(d.value.hostname=a.data.data.db_info.hostname,d.value.port=a.data.data.db_info.port+"",d.value.username=a.data.data.db_info.username,d.value.password=a.data.data.db_info.password,d.value.database_name=a.data.data.db_info.database_name,r.showDialog=!0)}catch(a){console.log("getDbInfoAPI error",a)}else n.value=""}});const y=b;return(l,e)=>{const s=J("Close"),a=L,o=U,c=q,S=$,i=E,T=M;return I(),O(T,{class:"dialog-alert custom-dialog-alert",modelValue:r.showDialog,"onUpdate:modelValue":e[8]||(e[8]=m=>r.showDialog=m),title:r.title,width:"480px","align-center":!0,style:{background:"#13322f"},"show-close":!1},{title:u(()=>[v("div",Y,[v("div",Z,z(r.title),1),v("div",{class:"dialog-close",onClick:e[0]||(e[0]=m=>r.showDialog=!1)},[t(a,{size:16},{default:u(()=>[t(s)]),_:1})])])]),footer:u(()=>[v("div",se,[t(i,{class:"default-btn",onClick:e[6]||(e[6]=m=>r.showDialog=!1)},{default:u(()=>[C(" 取消 ")]),_:1}),t(i,{class:"primary-btn",type:"primary",onClick:e[7]||(e[7]=m=>h(_.value))},{default:u(()=>[C(" 连接数据库名称 ")]),_:1})])]),default:u(()=>[v("div",ee,[t(S,{ref_key:"formRef",ref:_,rules:w,model:d.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:u(()=>[t(c,{label:"Host",prop:"hostname"},{default:u(()=>[t(o,{class:"input-width",modelValue:d.value.hostname,"onUpdate:modelValue":e[1]||(e[1]=m=>d.value.hostname=m),placeholder:""},null,8,["modelValue"])]),_:1}),t(c,{label:"Port",prop:"port"},{default:u(()=>[t(o,{class:"input-width",modelValue:d.value.port,"onUpdate:modelValue":e[2]||(e[2]=m=>d.value.port=m),placeholder:""},null,8,["modelValue"])]),_:1}),t(c,{label:"User",prop:"username"},{default:u(()=>[t(o,{class:"input-width",modelValue:d.value.username,"onUpdate:modelValue":e[3]||(e[3]=m=>d.value.username=m),placeholder:""},null,8,["modelValue"])]),_:1}),t(c,{label:"Pwd",prop:"password"},{default:u(()=>[t(o,{class:"input-width",modelValue:d.value.password,"onUpdate:modelValue":e[4]||(e[4]=m=>d.value.password=m),placeholder:""},null,8,["modelValue"])]),_:1}),t(c,{label:"db_name",prop:"database_name"},{default:u(()=>[t(o,{class:"input-width",modelValue:d.value.database_name,"onUpdate:modelValue":e[5]||(e[5]=m=>d.value.database_name=m),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])])]),_:1},8,["modelValue","title"])}}});const te=A(ae,[["__scopeId","data-v-3379a75d"]]),oe={class:"db-detail"},le={class:"group-btn"},ne=x({__name:"Detail",emits:["showSessions"],setup(B,{expose:f,emit:b}){const _=g(),r=V({showDialog:!1,db_id:""}),n=g({hostname:"",port:"",username:"",password:"",database_name:""}),d=V({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),w=async()=>{r.showDialog=!1},h=async e=>{var s,a;if(!e){p({type:"error",message:"参数异常",customClass:"custom-message"});return}try{(s=_.value)==null||s.resetFields(),r.db_id=e;const o=await P(r.db_id);o.status===200&&((a=o.data)==null?void 0:a.status)===200&&(n.value.hostname=o.data.data.db_info.hostname,n.value.port=o.data.data.db_info.port+"",n.value.username=o.data.data.db_info.username,n.value.password=o.data.data.db_info.password,n.value.database_name=o.data.data.db_info.database_name,r.showDialog=!0)}catch(o){console.log("getDbInfoAPI error",o)}},D=async e=>{e&&await e.validate(async(s,a)=>{var o;if(s)try{p({type:"info",message:"数据库保存中...",customClass:"custom-loading-message"});const c=await k(r.db_id,n.value);c.status===200&&((o=c.data)==null?void 0:o.status)===200?(l("showSessions"),p({type:"success",message:"数据库保存成功！",customClass:"custom-message"})):p({type:"error",message:"数据库保存失败，请重试！",customClass:"custom-message"})}catch(c){console.log("updateDbConnectionAPI error",c)}})},y=async e=>{R.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const a=await F(e);a.status===200&&((s=a.data)==null?void 0:s.status)===200&&(p({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),l("showSessions"),r.showDialog=!1)}catch{p({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};f({openDetail:h,closeDetail:w});const l=b;return(e,s)=>{const a=U,o=q,c=E,S=$;return Q((I(),N("div",oe,[t(S,{ref_key:"formRef",ref:_,rules:d,model:n.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:u(()=>[t(o,{label:"Host",prop:"hostname"},{default:u(()=>[t(a,{class:"input-width",modelValue:n.value.hostname,"onUpdate:modelValue":s[0]||(s[0]=i=>n.value.hostname=i),placeholder:""},null,8,["modelValue"])]),_:1}),t(o,{label:"Port",prop:"port"},{default:u(()=>[t(a,{class:"input-width",modelValue:n.value.port,"onUpdate:modelValue":s[1]||(s[1]=i=>n.value.port=i),placeholder:""},null,8,["modelValue"])]),_:1}),t(o,{label:"User",prop:"username"},{default:u(()=>[t(a,{class:"input-width",modelValue:n.value.username,"onUpdate:modelValue":s[2]||(s[2]=i=>n.value.username=i),placeholder:""},null,8,["modelValue"])]),_:1}),t(o,{label:"Pwd",prop:"password"},{default:u(()=>[t(a,{class:"input-width",modelValue:n.value.password,"onUpdate:modelValue":s[3]||(s[3]=i=>n.value.password=i),placeholder:""},null,8,["modelValue"])]),_:1}),t(o,{label:"db_name",prop:"database_name"},{default:u(()=>[t(a,{class:"input-width",modelValue:n.value.database_name,"onUpdate:modelValue":s[4]||(s[4]=i=>n.value.database_name=i),placeholder:""},null,8,["modelValue"])]),_:1}),t(o,null,{default:u(()=>[v("div",le,[t(c,{class:"primary-btn",type:"primary",onClick:s[5]||(s[5]=i=>D(_.value))},{default:u(()=>[C("保存")]),_:1}),t(c,{class:"default-btn",plain:"",onClick:s[6]||(s[6]=i=>y(r.db_id))},{default:u(()=>[C(" 删除")]),_:1})])]),_:1})]),_:1},8,["rules","model"])],512)),[[G,r.showDialog]])}}});const re=A(ne,[["__scopeId","data-v-6592a11c"]]),de={class:"db"},ue={class:"db-right"},ie=x({__name:"index",setup(B){const f=g(),b=g();W();const _=g([]);g({host:"127.0.1.0",port:"3306",user:"root",pwd:"3306",dbName:"爱迪生的数据库"}),g({content:"确认后该知识库将会被删除，且不可恢复",title:"确认删除？"});const r=async()=>{var l;_.value=[];try{const e=await K();e.status===200&&((l=e.data)==null?void 0:l.status)===200&&e.data.data&&e.data.data.length>0&&(_.value=e.data.data.map(s=>({id:s.id,name:s.database_name})))}catch(e){console.log("createDbConnectionAPI error",e)}},n=()=>{r()},d=()=>{var l;(l=f.value)==null||l.openDialog()},w=l=>{var e;console.log("querySession"+JSON.stringify(l)),(e=b.value)==null||e.openDetail(l.id)},h=l=>{var e;console.log("editSession"+JSON.stringify(l)),(e=f.value)==null||e.openDialog(l.id)},D=async l=>{console.log("deleteSession"+JSON.stringify(l)),y(l.id)},y=async l=>{R.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e,s;try{const a=await F(l);a.status===200&&((e=a.data)==null?void 0:e.status)===200&&(p({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),r(),(s=b.value)==null||s.closeDetail())}catch{p({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};return j(()=>{r()}),(l,e)=>(I(),N("div",de,[t(X,{title:"添加数据库",list:_.value,onAddSession:d,onQuerySession:w,onEditSession:h,onDeleteSession:D},null,8,["list"]),v("div",ue,[t(re,{ref_key:"DetailRef",ref:b,onShowSessions:n},null,512)]),t(te,{ref_key:"AddDialogRef",ref:f,onShowSessions:n},null,512)]))}});const fe=A(ie,[["__scopeId","data-v-7e43a853"]]);export{fe as default};
