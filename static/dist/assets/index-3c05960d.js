import{d as x,v as g,ab as C,U as T,o as I,M as J,w as d,a as w,t as M,b as o,O as S,P as m,ac as P,ad as O,ae as U,X as z,Y as k,af as q,ag as $,ah as E,Z as L,g as A,J as H,a0 as Q,c as N,ai as R,aj as F,m as j,a3 as X,f as Y}from"./index-0b8be2ed.js";import{S as Z}from"./index-148e4a21.js";/* empty css                  *//* empty css                   *//* empty css                     */const G={class:"dialog-title"},K={class:"dialog-title-name"},W={class:"dialog-content"},ee={class:"dialog-footer group-btn"},se=x({__name:"AddDialog",emits:["showSessions"],setup(B,{expose:b,emit:v}){const c=g(),n=C({showDialog:!1,formBtnLoading:!1,title:"连接SQL数据库",db_id:""}),a=g({hostname:"",port:"",username:"",password:"",database_name:""}),y=C({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),h=async p=>{p&&await p.validate(async(e,t)=>{var s;if(e){const r=m({type:"info",message:"数据库连接中...",customClass:"custom-loading-message"});try{let l;n.db_id?l=await P(n.db_id,a.value):l=await O(a.value),l.status===200&&((s=l.data)==null?void 0:s.status)===200?(D("showSessions"),r.close(),m({type:"success",message:"数据库连接成功！",customClass:"custom-message"}),n.showDialog=!1):(r.close(),m({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"}))}catch{r.close(),m({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}}})};b({openDialog:async p=>{var e,t;if(n.showDialog=!0,(e=c.value)==null||e.resetFields(),p)try{n.db_id=p;const s=await U(n.db_id);s.status===200&&((t=s.data)==null?void 0:t.status)===200&&(a.value.hostname=s.data.data.db_info.hostname,a.value.port=s.data.data.db_info.port+"",a.value.username=s.data.data.db_info.username,a.value.password=s.data.data.db_info.password,a.value.database_name=s.data.data.db_info.database_name,n.showDialog=!0)}catch(s){console.log("getDbInfoAPI error",s)}else n.db_id=""}});const D=v;return(p,e)=>{const t=T("Close"),s=z,r=k,l=q,f=$,_=E,i=L;return I(),J(i,{class:"dialog-alert custom-dialog-alert",modelValue:n.showDialog,"onUpdate:modelValue":e[8]||(e[8]=u=>n.showDialog=u),title:n.title,width:"480px","align-center":!0,style:{background:"#13322f"},"show-close":!1},{title:d(()=>[w("div",G,[w("div",K,M(n.title),1),w("div",{class:"dialog-close",onClick:e[0]||(e[0]=u=>n.showDialog=!1)},[o(s,{size:16},{default:d(()=>[o(t)]),_:1})])])]),footer:d(()=>[w("div",ee,[o(_,{class:"default-btn",onClick:e[6]||(e[6]=u=>n.showDialog=!1)},{default:d(()=>[S(" 取消 ")]),_:1}),o(_,{class:"primary-btn",type:"primary",onClick:e[7]||(e[7]=u=>h(c.value))},{default:d(()=>[S(" 连接数据库名称 ")]),_:1})])]),default:d(()=>[w("div",W,[o(f,{ref_key:"formRef",ref:c,rules:y,model:a.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:d(()=>[o(l,{label:"Host",prop:"hostname"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.hostname,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value.hostname=u),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"Port",prop:"port"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.port,"onUpdate:modelValue":e[2]||(e[2]=u=>a.value.port=u),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"User",prop:"username"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.username,"onUpdate:modelValue":e[3]||(e[3]=u=>a.value.username=u),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"Pwd",prop:"password"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.password,"onUpdate:modelValue":e[4]||(e[4]=u=>a.value.password=u),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"db_name",prop:"database_name"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.database_name,"onUpdate:modelValue":e[5]||(e[5]=u=>a.value.database_name=u),placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])])]),_:1},8,["modelValue","title"])}}});const ae=A(se,[["__scopeId","data-v-2054cb3e"]]),te={class:"db-detail"},oe={class:"group-btn"},le=x({__name:"Detail",emits:["showSessions"],setup(B,{expose:b,emit:v}){const c=g(),n=C({showDialog:!1,db_id:""}),a=g({hostname:"",port:"",username:"",password:"",database_name:""}),y=C({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),h=async()=>{n.showDialog=!1},V=async t=>{var s,r;if(!t){m({type:"error",message:"参数异常",customClass:"custom-message"});return}try{(s=c.value)==null||s.resetFields(),n.db_id=t;const l=await U(n.db_id);l.status===200&&((r=l.data)==null?void 0:r.status)===200&&(a.value.hostname=l.data.data.db_info.hostname,a.value.port=l.data.data.db_info.port+"",a.value.username=l.data.data.db_info.username,a.value.password=l.data.data.db_info.password,a.value.database_name=l.data.data.db_info.database_name,n.showDialog=!0)}catch(l){console.log("getDbInfoAPI error",l)}},D=async t=>{t&&await t.validate(async(s,r)=>{var l;if(s){const f=m({type:"info",message:"数据库保存中...",customClass:"custom-loading-message"});try{const _=await P(n.db_id,a.value);_.status===200&&((l=_.data)==null?void 0:l.status)===200?(e("showSessions"),f.close(),m({type:"success",message:"数据库保存成功！",customClass:"custom-message"})):(f.close(),m({type:"error",message:"数据库保存失败，请重试！",customClass:"custom-message"}))}catch(_){f.close(),console.log("updateDbConnectionAPI error",_),m({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}}})},p=async t=>{R.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const r=await F(t);r.status===200&&((s=r.data)==null?void 0:s.status)===200&&(m({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),e("showSessions"),n.showDialog=!1)}catch{m({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};b({openDetail:V,closeDetail:h});const e=v;return(t,s)=>{const r=k,l=q,f=E,_=$;return H((I(),N("div",te,[o(_,{ref_key:"formRef",ref:c,rules:y,model:a.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:d(()=>[o(l,{label:"Host",prop:"hostname"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.hostname,"onUpdate:modelValue":s[0]||(s[0]=i=>a.value.hostname=i),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"Port",prop:"port"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.port,"onUpdate:modelValue":s[1]||(s[1]=i=>a.value.port=i),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"User",prop:"username"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.username,"onUpdate:modelValue":s[2]||(s[2]=i=>a.value.username=i),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"Pwd",prop:"password"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.password,"onUpdate:modelValue":s[3]||(s[3]=i=>a.value.password=i),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,{label:"db_name",prop:"database_name"},{default:d(()=>[o(r,{class:"input-width",modelValue:a.value.database_name,"onUpdate:modelValue":s[4]||(s[4]=i=>a.value.database_name=i),placeholder:""},null,8,["modelValue"])]),_:1}),o(l,null,{default:d(()=>[w("div",oe,[o(f,{class:"primary-btn",type:"primary",onClick:s[5]||(s[5]=i=>D(c.value))},{default:d(()=>[S("保存")]),_:1}),o(f,{class:"default-btn",plain:"",onClick:s[6]||(s[6]=i=>p(n.db_id))},{default:d(()=>[S(" 删除")]),_:1})])]),_:1})]),_:1},8,["rules","model"])],512)),[[Q,n.showDialog]])}}});const ne=A(le,[["__scopeId","data-v-0cdb58b8"]]),re={class:"db"},de={class:"db-right"},ue=x({__name:"index",setup(B){const b=g(),v=g();Y();const c=g([]);g({host:"127.0.1.0",port:"3306",user:"root",pwd:"3306",dbName:"爱迪生的数据库"}),g({content:"确认后该知识库将会被删除，且不可恢复",title:"确认删除？"});const n=async()=>{var e;c.value=[];try{const t=await X();t.status===200&&((e=t.data)==null?void 0:e.status)===200&&t.data.data&&t.data.data.length>0&&(c.value=t.data.data.map(s=>({id:s.id,name:s.database_name})))}catch(t){console.log("createDbConnectionAPI error",t)}},a=()=>{n()},y=()=>{var e;(e=b.value)==null||e.openDialog()},h=e=>{var t;console.log("querySession"+JSON.stringify(e)),(t=v.value)==null||t.openDetail(e.id)},V=e=>{var t;console.log("editSession"+JSON.stringify(e)),(t=b.value)==null||t.openDialog(e.id)},D=async e=>{console.log("deleteSession"+JSON.stringify(e)),p(e.id)},p=async e=>{R.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var t,s;try{const r=await F(e);r.status===200&&((t=r.data)==null?void 0:t.status)===200&&(m({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),n(),(s=v.value)==null||s.closeDetail())}catch{m({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};return j(()=>{n()}),(e,t)=>(I(),N("div",re,[o(Z,{title:"添加数据库",list:c.value,onAddSession:y,onQuerySession:h,onEditSession:V,onDeleteSession:D},null,8,["list"]),w("div",de,[o(ne,{ref_key:"DetailRef",ref:v,onShowSessions:a},null,512)]),o(ae,{ref_key:"AddDialogRef",ref:b,onShowSessions:a},null,512)]))}});const ge=A(ue,[["__scopeId","data-v-7e43a853"]]);export{ge as default};
