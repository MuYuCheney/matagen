import{av as $e,d as H,ab as te,v as p,m as ae,o as b,M as R,w as s,a as t,t as u,au as Oe,p as le,e as se,g as G,Z as Ee,b as l,O as I,aw as Ae,ah as oe,x as X,q as Re,c as $,u as z,P as S,ax as Be,ai as Ue,f as Le,ay as ze,az as qe,F as q,r as W,K as ee,aA as We,N as Fe,aB as F,aa as Je,a7 as He,ag as Ge,Y as je,_ as Qe,aC as Ke,aD as Ye,aE as Ze,aF as Xe}from"./index-f3f8eb0f.js";/* empty css                  */import{N as et,P as tt,S as at,A as lt,V as st,Q as ot,c as nt,E as rt,J as ct,a as it,b as ut,C as dt,d as _t}from"./scrollbar-dcd7a61b.js";const vt=d=>$e.get("/CheckOrderExecute/GetAllWarehouseSelect?Id="+d),B=d=>(le("data-v-5c243f82"),d=d(),se(),d),pt={class:"header"},ht={class:"detail"},gt={class:"name"},ft={class:"content"},mt={class:"item"},St=B(()=>t("div",{class:"label"},"批次：",-1)),yt={class:"value"},bt={class:"item"},Ct=B(()=>t("div",{class:"label"},"当前库位：",-1)),It={class:"value"},kt={class:"item"},wt=B(()=>t("div",{class:"label"},"所在料箱：",-1)),Nt={class:"value"},Dt={class:"item"},xt=B(()=>t("div",{class:"label"},"当前库存：",-1)),Pt={class:"value"},Vt={class:"item"},Mt=B(()=>t("div",{class:"label"},"实际库存：",-1)),Tt={class:"value"},$t=H({__name:"AddDetailDrawer",setup(d,{expose:E}){const g=te({showDrawer:!1,direction:"rtl",size:450,title:"物料详情"}),f=p();return E({openDrawer:async x=>{f.value=x,g.showDrawer=!0}}),ae(()=>{document.querySelector(".drawer-modal").setAttribute("style","height: calc(100% - 64px) !important;top:auto;bottom:0;")}),(x,P)=>{const k=Oe;return b(),R(k,{modelValue:g.showDrawer,"onUpdate:modelValue":P[0]||(P[0]=h=>g.showDrawer=h),"modal-class":"drawer-modal",title:g.title,direction:g.direction,size:g.size},{header:s(()=>[t("div",pt,u(g.title),1)]),default:s(()=>{var h,V,m,D,n;return[t("div",ht,[t("div",gt,"物料名称："+u((h=f.value)==null?void 0:h.MaterialName),1),t("div",ft,[t("div",mt,[St,t("div",yt,u((V=f.value)==null?void 0:V.BatchNo),1)]),t("div",bt,[Ct,t("div",It,u((m=f.value)==null?void 0:m.Position),1)]),t("div",kt,[wt,t("div",Nt,u((D=f.value)==null?void 0:D.BoxNo),1)]),t("div",Dt,[xt,t("div",Pt,u((n=f.value)==null?void 0:n.OriginalNumber),1)]),t("div",Vt,[Mt,t("div",Tt,u(f.value&&f.value.CorrectNumber?f.value.CorrectNumber:"-"),1)])])])]}),_:1},8,["modelValue","title","direction","size"])}}});const Ot=G($t,[["__scopeId","data-v-5c243f82"]]),Et={class:"info"},At={class:"dialog-footer"},Rt=H({__name:"tip-dialog",props:{title:{type:String,default:"返回"},content:{type:String,default:"当前存在未保存数据！"},confirmText:{type:String,default:"确定"},cancelText:{type:String,default:"取消"}},emits:["confirm"],setup(d,{expose:E,emit:g}){const f=p(),o=te({showDialog:!1,title:"返回"});E({openDialog:async k=>{o.showDialog=!0,f.value=k}});const P=g;return(k,h)=>{const V=Ae,m=oe,D=Ee;return b(),R(D,{class:"dialog-alert tip-dialog",modelValue:o.showDialog,"onUpdate:modelValue":h[3]||(h[3]=n=>o.showDialog=n),"align-center":!0},{footer:s(()=>[t("div",At,[l(m,{class:"dialog-footer-btn cancel-btn",onClick:h[1]||(h[1]=n=>o.showDialog=!1)},{default:s(()=>[I(u(d.cancelText),1)]),_:1}),l(m,{class:"dialog-footer-btn",type:"primary",onClick:h[2]||(h[2]=n=>P("confirm",f.value))},{default:s(()=>[I(u(d.confirmText),1)]),_:1})])]),default:s(()=>[l(V,{class:"dialog-header",title:d.title,onClose:h[0]||(h[0]=()=>o.showDialog=!1)},null,8,["title"]),t("div",Et,u(d.content),1)]),_:1},8,["modelValue"])}}});const Bt=G(Rt,[["__scopeId","data-v-0c0fe8a1"]]),Ut={OperateNumber:[{required:!0,trigger:"blur",message:"请输入数量"}]},O=d=>(le("data-v-5537f868"),d=d(),se(),d),Lt={class:"page-back-header"},zt=O(()=>t("span",{class:"text-large font-500 mr-3"}," 订单执行 ",-1)),qt={class:"container"},Wt={class:"query-content"},Ft=O(()=>t("div",{class:"label"},"筛选",-1)),Jt={class:"page-content"},Ht={class:"button-group"},Gt={key:0,class:"card-list"},jt=["onClick"],Qt={class:"title"},Kt={class:"title-index"},Yt={class:"title-value"},Zt={class:"content"},Xt={class:"content-item"},ea=O(()=>t("span",{class:"content-label"},"批次：",-1)),ta={class:"content-value"},aa={class:"content-item"},la=O(()=>t("span",{class:"content-label"},"当前库位：",-1)),sa={class:"content-value"},oa={class:"content-item"},na=O(()=>t("span",{class:"content-label"},"所在料箱：",-1)),ra={class:"content-value"},ca={class:"content-item"},ia=O(()=>t("span",{class:"content-label"},"当前库存：",-1)),ua={class:"content-value"},da={class:"content-item"},_a=O(()=>t("span",{class:"content-label"},"实际库存：",-1)),va={class:"content-value"},pa={class:"card-item-btn-group"},ha={class:"popover-content"},ga={class:"popover-btn-group"},fa=H({__name:"orderImplement",setup(d){const E=Le(),g=ze(),f=[et,tt,at,lt,st],o=p([]),x=p(),P=p(),k=p({title:"提示",content:"",confirmText:"确定",cancelText:"返回"}),h=X(()=>(n.value.CurrentPage-1)*n.value.PageSize),V=X(()=>Math.ceil(n.value.Total/n.value.PageSize)),m=p([]),D=p([]),n=p({CurrentPage:1,PageSize:15,Total:0}),w=p({WareHouseId:"",CheckStatus:"",Text:""}),j=p(-1),U=p(),Q=p([]),A=p({OperateNumber:null}),ne=e=>{j.value=e},J=p([]),L=async()=>{const e=localStorage.getItem("checkList")?JSON.parse(localStorage.getItem("checkList")||"[]"):[];o.value=e;const{data:a}=await ot({...w.value,CurrentPage:n.value.CurrentPage,PageSize:n.value.PageSize});(a==null?void 0:a.ReturnStatus)===0?(m.value=a.Result.List,n.value=a.Result.Pagination,o.value.length&&m.value.forEach(_=>{o.value.forEach(c=>{_.Id==c.Id&&(_.ApplyNumber=c.ApplyNumber)})})):S.error(a.ErrorMessage)},re=async()=>{const{data:e}=await vt(0);(e==null?void 0:e.ReturnStatus)===0?(D.value=e.Result,w.value.WareHouseId=String(D.value[0].Value)):S.error(e.ErrorMessage)},ce=async()=>{const{data:e}=await nt();(e==null?void 0:e.ReturnStatus)===0?(J.value=e.Result,w.value.CheckStatus=String(J.value[0].Value)):S.error(e.ErrorMessage)},ie=async()=>{var a;const{data:e}=await ct();(e==null?void 0:e.ReturnStatus)===0?E.go(-1):(k.value={title:"提示",content:`${e.ErrorMessage}`,confirmText:"确定",cancelText:"返回"},(a=P.value)==null||a.openDialog())};ae(async()=>{await re(),await ce(),await L()});const ue=()=>{n.value.CurrentPage=1,n.value.Total=0,L()},K=p(),de=e=>{K.value=e},_e=e=>{n.value.CurrentPage=e.activeIndex+1,L()},ve=e=>{e.slideTo(n.value.CurrentPage-1)},pe=e=>{n.value.CurrentPage=e,K.value.slideTo(e-1),L()},he=async()=>{if(!o.value.length)return S.error("请至少选中一条数据！");const e=localStorage.getItem("editList");let a=e?JSON.parse(e):[],_=!1;if(a.forEach(i=>{o.value.forEach(C=>{i.Id==C.Id&&(_=!0)})}),!_||a.length===0){S.error("无待保存的数据，不能保存！");return}let c=a.map(i=>({WareHouseId:i.WareHouseId,MaterialId:i.MaterialId,BatchNo:i.BatchNo,ShelfUnitId:i.ShelfUnitId,ShelfNo:i.ShelfNo,ShelfUnitNo:i.ShelfUnitNo,TheStorey:i.TheStorey,MaterialName:i.MaterialName,MaterialNo:i.MaterialNo,MaterialSpecification:i.MaterialSpecification,OriginalNumber:i.OriginalNumber,CorrectNumber:i.CorrectNumber,IsProduct:i.IsProduct,CheckOrderToolDetail:i.CheckOrderToolDetail})),M={Id:g.query.Id,WarehouseId:g.query.WarehouseId,OrderMaterialDetails:c};const{data:y}=await rt(M);(y==null?void 0:y.ReturnStatus)===0?(S.success("保存成功"),o.value=[]):S.error(y.ErrorMessage)},ge=e=>{var a;(a=x.value)==null||a.openDrawer(e)},fe=(e,a)=>{U.value[a].resetFields()},me=async e=>{let a=F.getCache("DeliveryData"),_=F.getCache("ReceivingData");if(!a)return S.error("请先选择出库口");const{data:c}=await dt({OrderId:g.query.Id,ShelfUnitId:e.ShelfUnitId,InTerminal:_?_.Value:"",OutTerminal:a?a.Value:"",MaterialBoxId:e.BoxId});(c==null?void 0:c.ReturnStatus)===0?S.success("叫料成功"):S.error(c.ErrorMessage)},Se=async e=>{let a=F.getCache("DeliveryData"),_=F.getCache("ReceivingData");if(!_)return S.error("请先选择入库口");const{data:c}=await _t({OrderId:g.query.Id,ShelfUnitId:e.ShelfUnitId,InTerminal:_?_.Value:"",OutTerminal:a?a.Value:"",MaterialBoxId:e.BoxId});(c==null?void 0:c.ReturnStatus)===0?S.success("送料成功"):S.error(c.ErrorMessage)},ye=e=>{Q.value.push(e)},Y=e=>{Q.value[e].hide()},be=e=>{/^[0-9]\d*$/.test(e)||(A.value.OperateNumber=e.replace(/[^0-9]/g,""))},Ce=async(e,a)=>{U.value&&await U.value[a].validate(async _=>{if(_){let c=m.value.findIndex(y=>y.Id==e.Id),M=m.value[a];c!=-1&&(m.value[a].CorrectNumber=Number(A.value.OperateNumber),o.value.includes(M)||(o.value.push(M),localStorage.setItem("checkList",JSON.stringify(o.value)),localStorage.setItem("editList",JSON.stringify(o.value))),Y(a))}})},Ie=()=>{ie()},ke=()=>{E.go(-1)},we=e=>{o.value=e,localStorage.setItem("checkList",JSON.stringify(o.value))},Ne=()=>{o.value.length===m.value.length?(o.value=[],localStorage.setItem("checkList",JSON.stringify(o.value))):(o.value=m.value.map(e=>e),localStorage.setItem("checkList",JSON.stringify(o.value)))};return Re(()=>{localStorage.removeItem("checkList"),localStorage.removeItem("editList")}),(e,a)=>{const _=Be,c=Je,M=He,y=Ge,i=je,C=oe,Z=Ue,De=Qe,xe=Ke,Pe=Ye,Ve=Ze,Me=Xe;return b(),$("div",null,[t("div",Lt,[l(_,{icon:z(qe),onBack:Ie},{content:s(()=>[zt]),_:1},8,["icon"])]),t("div",qt,[t("div",Wt,[Ft,l(Z,{inline:!0,model:w.value,class:"demo-form-inline","show-message":!1,style:{width:"max-content"},size:"large"},{default:s(()=>[l(y,{label:"库房"},{default:s(()=>[l(M,{class:"input-width",modelValue:w.value.WareHouseId,"onUpdate:modelValue":a[0]||(a[0]=v=>w.value.WareHouseId=v),placeholder:"请选择库房"},{default:s(()=>[(b(!0),$(q,null,W(D.value,v=>(b(),R(c,{key:v.Value,label:v.Name,value:v.Value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"盘点状态"},{default:s(()=>[l(M,{class:"input-width",modelValue:w.value.CheckStatus,"onUpdate:modelValue":a[1]||(a[1]=v=>w.value.CheckStatus=v),placeholder:"全部"},{default:s(()=>[(b(!0),$(q,null,W(J.value,v=>(b(),R(c,{key:v.Value,label:v.Name,value:v.Value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"物料"},{default:s(()=>[l(i,{class:"input-width",modelValue:w.value.Text,"onUpdate:modelValue":a[2]||(a[2]=v=>w.value.Text=v),placeholder:"请输入物料名称/规格型号/批次号"},null,8,["modelValue"])]),_:1}),l(y,null,{default:s(()=>[l(C,{class:"qry-btn",color:"#416AF1",type:"primary",onClick:ue},{default:s(()=>[I(" 查询 ")]),_:1})]),_:1})]),_:1},8,["model"])]),t("div",Jt,[t("div",Ht,[l(C,{type:"primary",link:"",plain:"",onClick:Ne},{default:s(()=>[I(" 全选 ")]),_:1}),l(C,{class:"button-group-oper",color:"#416AF1",type:"primary",onClick:he},{default:s(()=>[l(De,{class:"svg-icon","icon-class":"save"}),I("保存 ")]),_:1})]),l(z(ut),{modules:f,loop:!1,"slides-per-view":1,"space-between":0,virtual:"","watch-slides-progress":!0,watchSlidesVisibility:!0,"initial-slide":n.value.CurrentPage-1,pagination:{el:".swiper-pagination",type:"bullets",clickable:!0,dynamicBullets:!0,dynamicMainBullets:1,bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active"},class:"swiperBox",onSwiper:de,onSlideChange:_e,onUpdate:ve},{default:s(()=>[(b(!0),$(q,null,W(V.value,v=>(b(),R(z(it),{key:v,"virtual-index":v-1},{default:s(({isActive:Te})=>[l(Ve,{modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=r=>o.value=r),onChange:we},{default:s(()=>[Te?(b(),$("div",Gt,[(b(!0),$(q,null,W(m.value,(r,T)=>(b(),$("div",{class:ee(["card-item",{"swiper-card-active":j.value==T}]),key:T,onClick:N=>ne(T)},[t("div",Qt,[t("div",Kt,u(h.value+T+1),1),t("div",Yt,"物料名称："+u(r.MaterialName),1),l(xe,{style:{"margin-left":"auto"},size:"large",value:r},null,8,["value"])]),t("div",Zt,[t("div",Xt,[ea,t("span",ta,u(r.BatchNo),1)]),t("div",aa,[la,t("span",sa,u(r.Position),1)]),t("div",oa,[na,t("span",ra,u(r.BoxNo),1)]),t("div",ca,[ia,t("span",ua,u(r.OriginalNumber),1)]),t("div",da,[_a,t("span",va,u(r.CorrectNumber!==null?r.CorrectNumber:"-"),1)])]),t("div",pa,[l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>ge(r)},{default:s(()=>[I(" 查看 ")]),_:2},1032,["onClick"]),l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>me(r)},{default:s(()=>[I(" 叫料 ")]),_:2},1032,["onClick"]),l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:N=>Se(r)},{default:s(()=>[I(" 送料 ")]),_:2},1032,["onClick"]),l(Pe,{"show-arrow":!0,trigger:"click","popper-class":"editNumber-popover",ref_for:!0,ref:N=>ye(N)},{reference:s(()=>[l(C,{class:"card-item-btn",type:"primary",plain:"",onClick:We(N=>fe(r,T),["stop"])},{default:s(()=>[I(" 实际库存 ")]),_:2},1032,["onClick"])]),default:s(()=>[t("div",ha,[l(Z,{ref_for:!0,ref_key:"formAddRef",ref:U,model:A.value,rules:z(Ut),class:"demo-form-inline","label-width":"100px",size:"large","hide-required-asterisk":!0},{default:s(()=>[l(y,{label:"输入数量",prop:"OperateNumber"},{default:s(()=>[l(i,{class:"select","adjust-position":!0,clearable:"",modelValue:A.value.OperateNumber,"onUpdate:modelValue":a[3]||(a[3]=N=>A.value.OperateNumber=N),onInput:be,placeholder:"请输入数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t("div",ga,[l(C,{class:"popover-btn cancel-btn",onClick:N=>Y(T)},{default:s(()=>[I(" 取消 ")]),_:2},1032,["onClick"]),l(C,{class:"popover-btn",type:"primary",onClick:N=>Ce(r,T)},{default:s(()=>[I(" 确定 ")]),_:2},1032,["onClick"])])])]),_:2},1536)]),t("div",{class:ee(["card-tag",{"not-call":r.ShelfUnitCallMaterialStatus=="0","had-call":r.ShelfUnitCallMaterialStatus=="1"||r.ShelfUnitCallMaterialStatus=="2","finish-call":r.ShelfUnitCallMaterialStatus=="4"}])},u(r.ShelfUnitCallMaterialStatusStr),3)],10,jt))),128))])):Fe("",!0)]),_:2},1032,["modelValue"])]),_:2},1032,["virtual-index"]))),128)),l(Me,{currentPage:n.value.CurrentPage,total:n.value.Total,pageSize:n.value.PageSize,page:V.value,onSelectPagination:pe},null,8,["currentPage","total","pageSize","page"])]),_:1},8,["initial-slide"])])]),l(Ot,{ref_key:"addDetailDrawerRef",ref:x},null,512),l(Bt,{ref_key:"tipDialogRef",ref:P,title:k.value.title,confirmText:k.value.confirmText,content:k.value.content,cancelText:k.value.cancelText,onConfirm:ke},null,8,["title","confirmText","content","cancelText"])])}}});const ba=G(fa,[["__scopeId","data-v-5537f868"]]);export{ba as default};
