import{d as C,v as _,ab as D,J as q,a0 as R,o as x,c as V,b as o,w as c,a as A,O as S,P as u,ac as I,ad as B,ae as N,af as P,Y as U,ag as J,ah as O,ai as T,g as E,m as $,a3 as F,f as M,aj as j}from"./index-f3f8eb0f.js";import{S as z}from"./index-8888c42f.js";const H={class:"db-detail"},L={class:"group-btn"},Q=C({__name:"Detail",emits:["showSessions"],setup(k,{expose:g,emit:p}){const m=_(),l=D({showDialog:!1,db_id:""}),t=_({hostname:"",port:"",username:"",password:"",database_name:""}),f=D({hostname:[{required:!0,message:"不能为空",trigger:"blur"}],port:[{required:!0,message:"不能为空",trigger:"blur"}],username:[{required:!0,message:"不能为空",trigger:"blur"}],password:[{required:!0,message:"不能为空",trigger:"blur"}],database_name:[{required:!0,message:"不能为空",trigger:"blur"}]}),v=async()=>{l.showDialog=!1},y=async i=>{var e,s;if(!i){u({type:"error",message:"参数异常",customClass:"custom-message"});return}try{(e=m.value)==null||e.resetFields(),l.db_id=i;const a=await I(l.db_id);a.status===200&&((s=a.data)==null?void 0:s.status)===200&&(t.value.hostname=a.data.data.db_info.hostname,t.value.port=a.data.data.db_info.port+"",t.value.username=a.data.data.db_info.username,t.value.password=a.data.data.db_info.password,t.value.database_name=a.data.data.db_info.database_name,l.showDialog=!0)}catch(a){console.log("getDbInfoAPI error",a)}},h=async i=>{i&&await i.validate(async(e,s)=>{var a;if(e){const d=u({type:"info",message:"数据库保存中...",customClass:"custom-loading-message"});try{const n=await B(l.db_id,t.value);n.status===200&&((a=n.data)==null?void 0:a.status)===200?(b("showSessions"),d.close(),u({type:"success",message:"数据库保存成功！",customClass:"custom-message"})):(d.close(),u({type:"error",message:"数据库保存失败，请重试！",customClass:"custom-message"}))}catch(n){d.close(),console.log("updateDbConnectionAPI error",n),u({type:"error",message:"数据库连接失败，请重试！",customClass:"custom-message"})}}})},w=async i=>{N.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e;try{const s=await P(i);s.status===200&&((e=s.data)==null?void 0:e.status)===200&&(u({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),b("showSessions"),l.showDialog=!1)}catch{u({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};g({openDetail:y,closeDetail:v});const b=p;return(i,e)=>{const s=U,a=J,d=O,n=T;return q((x(),V("div",H,[o(n,{ref_key:"formRef",ref:m,rules:f,model:t.value,class:"demo-form-dialog",style:{width:"max-content"},size:"large","label-width":72},{default:c(()=>[o(a,{label:"Host",prop:"hostname"},{default:c(()=>[o(s,{class:"input-width",modelValue:t.value.hostname,"onUpdate:modelValue":e[0]||(e[0]=r=>t.value.hostname=r),placeholder:""},null,8,["modelValue"])]),_:1}),o(a,{label:"Port",prop:"port"},{default:c(()=>[o(s,{class:"input-width",modelValue:t.value.port,"onUpdate:modelValue":e[1]||(e[1]=r=>t.value.port=r),placeholder:""},null,8,["modelValue"])]),_:1}),o(a,{label:"User",prop:"username"},{default:c(()=>[o(s,{class:"input-width",modelValue:t.value.username,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.username=r),placeholder:""},null,8,["modelValue"])]),_:1}),o(a,{label:"Pwd",prop:"password"},{default:c(()=>[o(s,{class:"input-width",modelValue:t.value.password,"onUpdate:modelValue":e[3]||(e[3]=r=>t.value.password=r),placeholder:""},null,8,["modelValue"])]),_:1}),o(a,{label:"db_name",prop:"database_name"},{default:c(()=>[o(s,{class:"input-width",modelValue:t.value.database_name,"onUpdate:modelValue":e[4]||(e[4]=r=>t.value.database_name=r),placeholder:""},null,8,["modelValue"])]),_:1}),o(a,null,{default:c(()=>[A("div",L,[o(d,{class:"primary-btn",type:"primary",onClick:e[5]||(e[5]=r=>h(m.value))},{default:c(()=>[S("保存")]),_:1}),o(d,{class:"default-btn",plain:"",onClick:e[6]||(e[6]=r=>w(l.db_id))},{default:c(()=>[S(" 删除")]),_:1})])]),_:1})]),_:1},8,["rules","model"])],512)),[[R,l.showDialog]])}}});const Y=E(Q,[["__scopeId","data-v-0cdb58b8"]]),G={class:"db"},K={class:"db-right"},W=C({__name:"index",setup(k){const g=_(),p=_();M();const m=_([]),l=_({hostname:"",port:"",username:"",password:"",database_name:""}),t=async()=>{var e;m.value=[];try{const s=await F();s.status===200&&((e=s.data)==null?void 0:e.status)===200&&s.data.data&&s.data.data.length>0&&(m.value=s.data.data.map(a=>({id:a.id,name:a.database_name})))}catch(s){console.log("createDbConnectionAPI error",s)}},f=()=>{var e;t(),(e=p.value)==null||e.closeDetail()},v=()=>{var e;(e=g.value)==null||e.openDialog()},y=e=>{var s;console.log("querySession"+JSON.stringify(e)),(s=p.value)==null||s.openDetail(e.id)},h=async e=>{var a,d;console.log("editSessionName"+JSON.stringify(e));const s=u({type:"info",message:"数据库重命名中...",customClass:"custom-loading-message"});try{let n=await I(e.id);if(n.status===200&&((a=n.data)==null?void 0:a.status)===200){l.value.hostname=n.data.data.db_info.hostname,l.value.port=n.data.data.db_info.port+"",l.value.username=n.data.data.db_info.username,l.value.password=n.data.data.db_info.password,l.value.database_name=e.name;let r=await B(e.id,l.value);r.status===200&&((d=r.data)==null?void 0:d.status)===200?(s.close(),u({type:"success",message:"数据库重命名成功！",customClass:"custom-message"}),f()):(s.close(),u({type:"error",message:"数据库重命名失败，请重试！",customClass:"custom-message"}))}}catch(n){s.close(),console.log("editSessionName error",n),u({type:"error",message:"数据库重命名失败，请重试！",customClass:"custom-message"})}},w=e=>{var s;console.log("editSession"+JSON.stringify(e)),(s=g.value)==null||s.openDialog(e.id)},b=async e=>{console.log("deleteSession"+JSON.stringify(e)),i(e.id)},i=async e=>{N.confirm("确认后该数据库连接会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s,a;try{const d=await P(e);d.status===200&&((s=d.data)==null?void 0:s.status)===200&&(u({type:"success",message:"数据库连接删除成功",customClass:"custom-message"}),t(),(a=p.value)==null||a.closeDetail())}catch{u({type:"error",message:"数据库连接删除失败",customClass:"custom-message"})}}).catch(()=>{})};return $(()=>{t()}),(e,s)=>(x(),V("div",G,[o(z,{title:"添加数据库",list:m.value,onAddSession:v,onQuerySession:y,onEditSession:w,onEditSessionName:h,onDeleteSession:b},null,8,["list"]),A("div",K,[o(Y,{ref_key:"DetailRef",ref:p,onShowSessions:f},null,512)]),o(j,{ref_key:"AddDialogRef",ref:g,onShowSessions:f},null,512)]))}});const ee=E(W,[["__scopeId","data-v-2a21f838"]]);export{ee as default};
